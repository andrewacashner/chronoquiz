{"ast":null,"code":"import{useState,useContext,useEffect,useReducer}from\"react\";import{useNavigate}from\"react-router-dom\";import User from\"../classes/User\";import Fact from\"../classes/Fact\";import Timeline from\"../classes/Timeline\";import UserContext from\"../store/UserContext\";import UploadForm from\"./UploadForm\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const defaultTimeline=new Timeline({title:'',description:'',keyword:[],creator:'',facts:[]});function timelineReducer(state,action){let obj=action.payload;let newState=null;switch(action.type){case\"set\":newState=new Timeline({...state,...obj});break;case\"reset\":newState=defaultTimeline;break;case\"addFact\":newState=state.addFact(obj.fact);break;case\"removeFact\":newState=state.removeFact(obj.fact);break;case\"addFacts\":newState=state.addFacts(obj);break;default:newState=state;}return newState;}const defaultFact=new Fact({date:new Date(),info:\"Description\",img:\"https://picsum.photos/200.jpg\"});function factReducer(state,action){let obj=action.payload;let newState=null;switch(action.type){case\"set\":newState=new Fact({...state,...obj});break;case\"reset\":newState=defaultFact;break;default:newState=state;};return newState;}function updateReducer(dispatchFn){return function(field){let setValueFn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return function(event){let value=event.target.value;let newValue=setValueFn?setValueFn(value):value;dispatchFn({type:\"set\",payload:{[field]:newValue}});};};}export default function AdminPanel(){let userContext=useContext(UserContext);let authenticated=userContext.get.authenticated;let currentUser=userContext.get.currentUser;let userToken=userContext.get.userToken;let[timelineState,dispatchTimeline]=useReducer(timelineReducer,defaultTimeline);let[factState,dispatchFact]=useReducer(factReducer,defaultFact);const updateFact=updateReducer(dispatchFact);const updateTimeline=updateReducer(dispatchTimeline);let[initialTimeline,setInitialTimeline]=useState(defaultTimeline);let[saveReady,setSaveReady]=useState(false);let[updateTimelineList,setUpdateTimelineList]=useState(true);let[refresh,setRefresh]=useState(true);function activeStyle(isActive){return isActive?\"active\":\"inactive\";}let[hasUnsavedChanges,setHasUnsavedChanges]=useState(false);useEffect(()=>{let status=timelineState&&initialTimeline&&!timelineState.equals(initialTimeline);if(initialTimeline){console.debug(initialTimeline);}if(timelineState){console.debug(timelineState);}setHasUnsavedChanges(status);},[timelineState,initialTimeline]);function Instructions(){return/*#__PURE__*/_jsx(\"p\",{className:\"instructions\",children:\"Your data will not be saved until you click Save.\"});}let[timelineList,setTimelineList]=useState([]);useEffect(()=>{async function loadTimelineList(user,token){let list=await user.loadUserTimelineList(token);if(list){setTimelineList(list);}}if(authenticated&&updateTimelineList){loadTimelineList(currentUser,userToken);setUpdateTimelineList(false);}else{setTimelineList([]);}},[authenticated,updateTimelineList,currentUser,userToken]);let[timelineID,setTimelineID]=useState(null);useEffect(()=>{async function loadTimeline(id,token){console.debug(\"Loading timeline id \".concat(timelineID));let response=await fetch(\"\".concat(User.SERVER,\"/timeline-full/\").concat(id),{method:\"GET\",headers:new Headers({\"Authorization\":\"Token \".concat(token)})});if(response.ok){let json=await response.json();console.debug(json);let creator=json.creator===\"\"?currentUser.username:json.creator;let newTimeline=new Timeline({id:json.id,title:json.title,description:json.description,keywords:Timeline.parseKeywords(json.keywords),creator:creator,facts:json.facts.map(f=>Fact.newFromYear(f))});dispatchTimeline({type:\"set\",payload:newTimeline});setInitialTimeline(newTimeline);}else{console.debug(\"Problem loading timeline with id \".concat(id,\": Server status \").concat(response.status,\", \").concat(response.statusText));}}if(timelineID){if(!hasUnsavedChanges||window.confirm(\"Your quiz has unsaved changes. Do you want to discard the changes and reload the quiz?\")){if(timelineID===\"create\"){dispatchTimeline({type:\"reset\"});}else{loadTimeline(timelineID,userToken);}setUpdateTimelineList(true);setRefresh(false);setHasUnsavedChanges(false);}}},[timelineID,currentUser.username,userToken,refresh]);function Chooser(){function loadTimeline(event){event.preventDefault();let data=new FormData(event.target);let id=data.get(\"select-timeline\");// TODO if there are no unsaved changes\nsetTimelineID(id);}function timelineOption(timeline){return/*#__PURE__*/_jsx(\"option\",{value:timeline.id,children:timeline.title},timeline.id);}let[currentTimelineSelection,setCurrentTimelineSelection]=useState(\"create\");function updateSelection(event){setCurrentTimelineSelection(event.target.value);}let loadButtonText=currentTimelineSelection===\"create\"?\"Create\":\"Load\";return/*#__PURE__*/_jsxs(\"form\",{id:\"chooser\",onSubmit:loadTimeline,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"select-timeline\",children:\"Select a Timeline:\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"select-timeline\",defaultValue:\"create\",onChange:updateSelection,children:[/*#__PURE__*/_jsx(\"option\",{value:\"create\",children:\"Create New\"}),timelineList.map(timelineOption)]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:loadButtonText})]});}function MetadataPanel(){let creator=timelineState.creator===\"\"?currentUser.username:timelineState.creator;return/*#__PURE__*/_jsxs(\"section\",{id:\"metadata\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Metadata\"}),/*#__PURE__*/_jsx(\"form\",{className:\"timelinePanel\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"formInputBlock\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",onBlur:updateTimeline(\"title\"),defaultValue:timelineState.title})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description\",children:\"Description\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"description\",onBlur:updateTimeline(\"description\"),defaultValue:timelineState.description})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"keywords\",children:\"Keywords (separated with semicolons)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"keywords\",onBlur:updateTimeline(\"keywords\",Timeline.parseKeywords),defaultValue:timelineState.keywordString})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"creator\",children:\"Creator (for public display; default: your username)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"creator\",onBlur:updateTimeline(\"creator\"),defaultValue:creator})]})]})})]});}function CurrentFactsPanel(){function currentFact(item){function deleteFact(event){if(window.confirm(\"Are you sure you want to delete the current fact?\")){console.debug(\"Delete item (date \".concat(item.date.getFullYear(),\")\"));dispatchTimeline({type:\"removeFact\",payload:{fact:item}});}}function editFact(event){console.debug(\"Edit item (date \".concat(item.date.getFullYear(),\")\"));dispatchFact({type:\"set\",payload:item});dispatchTimeline({type:\"removeFact\",payload:{fact:item}});}return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"FactListControls\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:editFact,children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:deleteFact,children:\"Delete\"})]})}),/*#__PURE__*/_jsx(\"td\",{children:String(item.year)}),/*#__PURE__*/_jsx(\"td\",{children:item.info}),/*#__PURE__*/_jsx(\"td\",{children:item.img})]},crypto.randomUUID());}function Instructions(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"instructions\",children:\"Enter timeline events manually or upload the data using the forms below\"}),/*#__PURE__*/_jsx(UploadForm,{dispatch:dispatchTimeline})]});}return/*#__PURE__*/_jsxs(\"section\",{id:\"currentTimeline\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Current Timeline Events\"}),/*#__PURE__*/_jsx(Instructions,{}),/*#__PURE__*/_jsxs(\"table\",{className:\"timeline\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Controls\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Year\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Image URL\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:timelineState.facts.map(currentFact)})]})]});}function NewFactForm(){function newFact(event){if(factState.date&&factState.info){dispatchTimeline({type:\"addFact\",payload:{fact:factState}});console.debug(\"Added fact to timeline\");dispatchFact({type:\"reset\"});}}function CardPreview(_ref){let{fact}=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"card\",\"data-when\":factState.year,\"data-noselect\":\"noselect\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"date\",children:factState.year}),/*#__PURE__*/_jsx(\"img\",{alt:factState.img,src:factState.img}),/*#__PURE__*/_jsx(\"span\",{className:\"info\",children:factState.info})]});}function dateFromYear(year){let date=new Date();date.setFullYear(year);return date;}return/*#__PURE__*/_jsxs(\"section\",{id:\"new\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Add an Event\"}),/*#__PURE__*/_jsxs(\"form\",{id:\"addFactForm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"formInputBlock\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"date\",children:\"Year\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"date\",max:defaultFact.year,onChange:updateFact(\"date\",dateFromYear),defaultValue:factState.year})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"info\",children:\"Description of event\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"info\",onBlur:updateFact(\"info\"),defaultValue:factState.info})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"img\",children:\"Complete URL of image (optional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",name:\"img\",onBlur:updateFact(\"img\"),defaultValue:factState.img})]})]}),/*#__PURE__*/_jsxs(\"section\",{id:\"preview\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Preview\"}),/*#__PURE__*/_jsx(CardPreview,{fact:factState})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",id:\"add\",onClick:newFact,children:\"Add\"})]})]});}function SaveButton(){return/*#__PURE__*/_jsx(\"button\",{className:activeStyle(hasUnsavedChanges),id:\"save\",type:\"button\",onClick:saveTimeline,children:\"Save\"});}// TODO indicate save state: \n// (1) metadata, (2) facts, (3) whole timeline on server\nfunction saveTimeline(event){let action=timelineState?\"Updated\":\"Created\";console.debug(\"\".concat(action,\" timeline with title '\").concat(timelineState.title,\"'\"));setSaveReady(true);}useEffect(()=>{async function postTimeline(user,token,timeline){console.debug(timeline.facts);console.debug(timeline.json());let response=await fetch(\"\".concat(User.SERVER,\"/timeline-full/\"),{method:\"POST\",headers:new Headers({\"Content-Type\":\"application/json\",\"Accept\":\"application/json\",\"Authorization\":\"Token \".concat(token)}),body:timeline.json()});if(response.ok){let json=await response.json();console.debug(json);}else{console.debug(\"Problem creating timeline: Server status \".concat(response.status,\", \").concat(response.statusText));}}if(saveReady){console.debug(\"Ready to post timeline\");console.debug(timelineState);postTimeline(currentUser,userToken,timelineState);setSaveReady(false);setUpdateTimelineList(true);setHasUnsavedChanges(false);}},[saveReady,timelineState,currentUser,userToken]);function DeleteTimelineButton(){let[timelineToDelete,setTimelineToDelete]=useState(null);function deleteTimeline(){if(window.confirm(\"Are you sure you want to delete this quiz? All of its fact cards will be lost. This action cannot be undone.\")){console.debug(timelineID);setTimelineToDelete(timelineID);}}useEffect(()=>{async function requestDeletion(timelineID,token){let result=false;let response=await fetch(\"\".concat(User.SERVER,\"/timelines/\").concat(timelineID,\"/\"),{method:\"DELETE\",headers:new Headers({\"Accept\":\"application/json\",\"Authorization\":\"Token \".concat(token)})});if(response.ok){let json=await response.json();console.debug(json);result=true;}else{console.debug(\"Could not delete timeline with id \".concat(timelineID,\": Server status \").concat(response.status,\", \").concat(response.statusText));result=false;}return result;}if(timelineToDelete!==null){console.debug(\"Deleting timeline with id \".concat(timelineToDelete));if(timelineID===\"create\"){dispatchTimeline({type:\"reset\"});}else{let deleted=requestDeletion(timelineToDelete,userToken);if(deleted){dispatchTimeline({type:\"reset\"});setUpdateTimelineList(true);}}setTimelineToDelete(null);}},[timelineToDelete]);let msg=timelineID===\"create\"?\"Reset Quiz\":\"Delete Quiz\";return/*#__PURE__*/_jsx(\"button\",{id:\"deleteTimeline\",type:\"button\",onClick:deleteTimeline,children:msg});}function DiscardChangesButton(){function discardChanges(event){setRefresh(true);}return/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:activeStyle(hasUnsavedChanges),onClick:discardChanges,children:\"Discard Changes\"});}function Controls(){return/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[/*#__PURE__*/_jsx(SaveButton,{}),/*#__PURE__*/_jsx(DiscardChangesButton,{}),/*#__PURE__*/_jsx(DeleteTimelineButton,{})]});}let navigate=useNavigate();if(authenticated){return/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Manage Your Quizzes\"}),/*#__PURE__*/_jsx(Instructions,{}),/*#__PURE__*/_jsx(Chooser,{}),/*#__PURE__*/_jsx(MetadataPanel,{}),/*#__PURE__*/_jsx(CurrentFactsPanel,{}),/*#__PURE__*/_jsx(NewFactForm,{}),/*#__PURE__*/_jsx(Controls,{})]});}else{navigate(\"/login\");}}","map":{"version":3,"names":["useState","useContext","useEffect","useReducer","useNavigate","User","Fact","Timeline","UserContext","UploadForm","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","defaultTimeline","title","description","keyword","creator","facts","timelineReducer","state","action","obj","payload","newState","type","addFact","fact","removeFact","addFacts","defaultFact","date","Date","info","img","factReducer","updateReducer","dispatchFn","field","setValueFn","arguments","length","undefined","event","value","target","newValue","AdminPanel","userContext","authenticated","get","currentUser","userToken","timelineState","dispatchTimeline","factState","dispatchFact","updateFact","updateTimeline","initialTimeline","setInitialTimeline","saveReady","setSaveReady","updateTimelineList","setUpdateTimelineList","refresh","setRefresh","activeStyle","isActive","hasUnsavedChanges","setHasUnsavedChanges","status","equals","console","debug","Instructions","className","children","timelineList","setTimelineList","loadTimelineList","user","token","list","loadUserTimelineList","timelineID","setTimelineID","loadTimeline","id","concat","response","fetch","SERVER","method","headers","Headers","ok","json","username","newTimeline","keywords","parseKeywords","map","f","newFromYear","statusText","window","confirm","Chooser","preventDefault","data","FormData","timelineOption","timeline","currentTimelineSelection","setCurrentTimelineSelection","updateSelection","loadButtonText","onSubmit","htmlFor","name","defaultValue","onChange","MetadataPanel","onBlur","keywordString","CurrentFactsPanel","currentFact","item","deleteFact","getFullYear","editFact","onClick","String","year","crypto","randomUUID","dispatch","NewFactForm","newFact","CardPreview","_ref","alt","src","dateFromYear","setFullYear","max","SaveButton","saveTimeline","postTimeline","body","DeleteTimelineButton","timelineToDelete","setTimelineToDelete","deleteTimeline","requestDeletion","result","deleted","msg","DiscardChangesButton","discardChanges","Controls","navigate"],"sources":["/home/andrewacashner/Documents/computing/javascript/react/chronoquiz/src/components/AdminPanel.tsx"],"sourcesContent":["import { useState, useContext, useEffect, useReducer } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n\nimport User from \"../classes/User\";\nimport Fact from \"../classes/Fact\";\nimport Timeline from \"../classes/Timeline\";\n\nimport UserContext from \"../store/UserContext\";\n\nimport UploadForm from \"./UploadForm\";\nconst defaultTimeline = new Timeline({\n  title: '',\n  description: '',\n  keyword: [],\n  creator: '',\n  facts: []\n});\n\nfunction timelineReducer(state, action) {\n  let obj = action.payload;\n\n  let newState = null;\n  \n  switch(action.type) {\n    case \"set\":\n      newState = new Timeline({ ...state, ...obj });\n    break;\n\n    case \"reset\":\n      newState = defaultTimeline;\n    break;\n\n    case \"addFact\":\n      newState = state.addFact(obj.fact);\n    break;\n\n    case \"removeFact\":\n      newState = state.removeFact(obj.fact);\n    break;\n\n    case \"addFacts\":\n      newState = state.addFacts(obj);\n    break;\n\n    default:\n      newState = state; \n  }\n\n  return newState;\n}\n\n\nconst defaultFact = new Fact({\n  date: new Date(),\n  info: \"Description\", \n  img: \"https://picsum.photos/200.jpg\"\n});\n\nfunction factReducer(state, action) {\n  let obj = action.payload;\n  let newState = null;\n\n  switch(action.type) {\n    case \"set\":\n      newState = new Fact({ ...state, ...obj });\n    break;\n\n    case \"reset\":\n      newState = defaultFact;\n    break;\n\n    default:\n      newState = state;\n  };\n\n  return newState;\n}\n\nfunction updateReducer(dispatchFn: (obj: object) => obj) {\n  return function(\n    field: string, \n    setValueFn: (value: any) => any = null\n  ): void {\n    return function(event): void {\n      let value = event.target.value;\n      let newValue = setValueFn ? setValueFn(value) : value;\n      dispatchFn({\n        type: \"set\",\n        payload: { \n          [field]: newValue\n        }\n      });\n    };\n  }\n}\n\n\nexport default function AdminPanel() {\n  let userContext = useContext(UserContext);\n  let authenticated = userContext.get.authenticated;\n  let currentUser   = userContext.get.currentUser;\n  let userToken     = userContext.get.userToken;\n\n  let [timelineState, dispatchTimeline] = useReducer(timelineReducer, defaultTimeline);\n  let [factState, dispatchFact] = useReducer(factReducer, defaultFact);\n  \n  const updateFact = updateReducer(dispatchFact);\n  const updateTimeline = updateReducer(dispatchTimeline);\n\n  let [initialTimeline, setInitialTimeline] = useState(defaultTimeline);\n\n  let [saveReady, setSaveReady] = useState(false);\n  let [updateTimelineList, setUpdateTimelineList] = useState(true);\n  let [refresh, setRefresh] = useState(true);\n  \n  function activeStyle(isActive) {\n    return isActive ? \"active\" : \"inactive\";\n  }\n\n  let [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n\n  useEffect(() => {\n    let status = ((timelineState && initialTimeline)\n            && !timelineState.equals(initialTimeline));\n            \n    if (initialTimeline) { console.debug(initialTimeline); }\n    if (timelineState) { console.debug(timelineState); }\n\n    setHasUnsavedChanges(status);\n  }, [timelineState, initialTimeline]);\n\n  function Instructions() {\n    return(\n      <p className=\"instructions\">Your data will not be saved until you click Save.</p>\n    );\n  }\n\n  let [timelineList, setTimelineList] = useState([]);\n\n  useEffect(() => {\n    async function loadTimelineList(user, token) {\n      let list = await user.loadUserTimelineList(token);\n      if (list) {\n        setTimelineList(list);\n      }\n    }\n    if (authenticated && updateTimelineList) {\n      loadTimelineList(currentUser, userToken);\n      setUpdateTimelineList(false);\n    } else {\n      setTimelineList([]);\n    }\n  }, [authenticated, updateTimelineList, currentUser, userToken]);\n\n  let [timelineID, setTimelineID] = useState(null);\n\n  useEffect(() => {\n    async function loadTimeline(id, token) {\n      console.debug(`Loading timeline id ${timelineID}`);\n      let response = await fetch(`${User.SERVER}/timeline-full/${id}`, {\n        method: \"GET\",\n        headers: new Headers({\n          \"Authorization\": `Token ${token}`\n        })\n      });\n\n      if (response.ok) {\n        let json = await response.json();\n        console.debug(json);\n        let creator = (json.creator === \"\")\n                      ? currentUser.username\n                      : json.creator;\n\n        let newTimeline = new Timeline({\n          id:           json.id,\n          title:        json.title,\n          description:  json.description,\n          keywords:     Timeline.parseKeywords(json.keywords),\n          creator:      creator,\n          facts:        json.facts.map(f => Fact.newFromYear(f))\n        });\n\n        dispatchTimeline({\n          type: \"set\",\n          payload: newTimeline\n        });\n\n        setInitialTimeline(newTimeline);\n\n      } else {\n        console.debug(`Problem loading timeline with id ${id}: Server status ${response.status}, ${response.statusText}`);\n      }\n    }\n\n    if (timelineID) {\n      if (!hasUnsavedChanges || window.confirm(\"Your quiz has unsaved changes. Do you want to discard the changes and reload the quiz?\")) {\n        if (timelineID === \"create\") {\n          dispatchTimeline({ type: \"reset\" });\n        } else {\n          loadTimeline(timelineID, userToken);\n        }\n        setUpdateTimelineList(true);\n        setRefresh(false);\n        setHasUnsavedChanges(false);\n      }\n    }\n  }, [timelineID, currentUser.username, userToken, refresh]);\n\n\n  function Chooser() {\n    function loadTimeline(event) {\n      event.preventDefault();\n      let data = new FormData(event.target);\n      let id = data.get(\"select-timeline\");\n      // TODO if there are no unsaved changes\n      setTimelineID(id);\n    }\n\n    function timelineOption(timeline) {\n      return(\n        <option key={timeline.id} value={timeline.id}>{timeline.title}</option>\n      );\n    }\n\n    let [currentTimelineSelection, setCurrentTimelineSelection] = useState(\"create\");\n\n    function updateSelection(event) {\n      setCurrentTimelineSelection(event.target.value);\n    }\n\n    let loadButtonText = (currentTimelineSelection === \"create\") \n                          ? \"Create\" : \"Load\";\n\n    return(\n      <form id=\"chooser\" onSubmit={loadTimeline}>\n        <label htmlFor=\"select-timeline\">Select a Timeline:</label>\n        <select name=\"select-timeline\" defaultValue=\"create\" onChange={updateSelection}>\n          <option value=\"create\">Create New</option>\n          { timelineList.map(timelineOption) }\n        </select>\n        <button type=\"submit\">{ loadButtonText }</button>\n      </form>\n    );\n  }\n\n  function MetadataPanel() {\n    let creator = (timelineState.creator === \"\") \n                  ? currentUser.username \n                  : timelineState.creator;\n\n    return(\n      <section id=\"metadata\">\n        <h2>Metadata</h2>\n        <form className=\"timelinePanel\">\n          <div className=\"formInputBlock\">\n            <div className=\"formItem\">\n              <label htmlFor=\"title\">Title</label>\n              <input type=\"text\" name=\"title\" \n                onBlur={updateTimeline(\"title\")}\n                defaultValue={timelineState.title} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"description\">Description</label>\n              <input type=\"text\" name=\"description\" \n                onBlur={updateTimeline(\"description\")}\n                defaultValue={timelineState.description} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"keywords\">Keywords (separated with semicolons)</label>\n              <input type=\"text\" name=\"keywords\" \n                onBlur={updateTimeline(\"keywords\", Timeline.parseKeywords)}\n                defaultValue={timelineState.keywordString} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"creator\">Creator (for public display; default: your username)</label>\n              <input type=\"text\" name=\"creator\" \n                onBlur={updateTimeline(\"creator\")}\n                defaultValue={creator}/>\n            </div>\n          </div>\n        </form>\n      </section>\n    );\n  }\n\n  function CurrentFactsPanel() {\n    function currentFact(item) {\n      function deleteFact(event) {\n        if (window.confirm(\"Are you sure you want to delete the current fact?\")) {\n          console.debug(`Delete item (date ${item.date.getFullYear()})`);\n          dispatchTimeline({ \n            type: \"removeFact\",\n            payload: { fact: item }\n          });\n        }\n      }\n\n      function editFact(event) {\n        console.debug(`Edit item (date ${item.date.getFullYear()})`);\n        dispatchFact({\n          type: \"set\",\n          payload: item\n        });\n        dispatchTimeline({ \n          type: \"removeFact\",\n          payload: { fact: item }\n        });\n      }\n\n      return(\n        <tr key={crypto.randomUUID()}>\n          <td>\n            <div className=\"FactListControls\">\n              <button type=\"button\" onClick={editFact}>Edit</button>\n              <button type=\"button\" onClick={deleteFact}>Delete</button>\n            </div>\n          </td>\n          <td>{String(item.year)}</td>\n          <td>{item.info}</td>\n          <td>{item.img}</td>\n        </tr>\n      );\n    }\n\n    function Instructions() {\n      return(\n        <>\n          <p className=\"instructions\">Enter timeline events manually or upload the data using the forms below</p>\n          <UploadForm dispatch={dispatchTimeline} />\n        </>\n      );\n    }\n\n    return(\n      <section id=\"currentTimeline\">\n        <h2>Current Timeline Events</h2>\n        <Instructions />\n        <table className=\"timeline\">\n          <thead>\n            <tr>\n              <th>Controls</th>\n              <th>Year</th>\n              <th>Description</th>\n              <th>Image URL</th>\n            </tr>\n          </thead>\n          <tbody>\n            { timelineState.facts.map(currentFact) }\n          </tbody>\n        </table>\n      </section>\n    );\n  }\n\n  function NewFactForm() {\n\n    function newFact(event) {\n      if (factState.date && factState.info) {\n        dispatchTimeline({\n          type: \"addFact\",\n          payload: { fact: factState }\n        });\n        console.debug(\"Added fact to timeline\");\n        dispatchFact({ type: \"reset\" });\n      }\n    }\n    \n    function CardPreview({ fact }) {\n      return(\n        <div className=\"card\" data-when={factState.year} data-noselect=\"noselect\">\n          <span className=\"date\">{factState.year}</span>\n          <img alt={factState.img} src={factState.img} />\n          <span className=\"info\">{factState.info}</span>\n        </div>\n      );\n    }\n\n\n    function dateFromYear(year: number): Date {\n      let date = new Date();\n      date.setFullYear(year);\n      return date\n    }\n\n    return(\n      <section id=\"new\">\n        <h2>Add an Event</h2>\n        <form id=\"addFactForm\">\n          <div className=\"formInputBlock\">\n            <div className=\"formItem\">\n              <label htmlFor=\"date\">Year</label>\n              <input \n                type=\"number\" \n                name=\"date\" \n                max={defaultFact.year}\n                onChange={updateFact(\"date\", dateFromYear)}\n                defaultValue={factState.year} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"info\">Description of event</label>\n              <input \n                type=\"text\" \n                name=\"info\" \n                onBlur={updateFact(\"info\")}\n                defaultValue={factState.info} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"img\">Complete URL of image (optional)</label>\n              <input \n                type=\"url\" \n                name=\"img\" \n                onBlur={updateFact(\"img\")}\n                defaultValue={factState.img} />\n            </div>\n          </div>\n          <section id=\"preview\">\n            <h3>Preview</h3>\n            <CardPreview fact={factState} />\n          </section>\n          <button type=\"button\" id=\"add\" onClick={newFact}>Add</button>\n        </form>\n      </section>\n    );\n  }\n\n  \n  function SaveButton() {\n    return(\n      <button className={activeStyle(hasUnsavedChanges)} id=\"save\" type=\"button\" onClick={saveTimeline}>Save</button>\n    );\n  }\n\n\n  // TODO indicate save state: \n  // (1) metadata, (2) facts, (3) whole timeline on server\n  function saveTimeline(event) {\n    let action = timelineState ? \"Updated\" : \"Created\";\n    console.debug(`${action} timeline with title '${timelineState.title}'`);\n    setSaveReady(true);\n  }\n\n  useEffect(() => {\n    async function postTimeline(user, token, timeline) {\n      console.debug(timeline.facts);\n      console.debug(timeline.json());\n      let response = await fetch(`${User.SERVER}/timeline-full/`, {\n        method: \"POST\",\n        headers: new Headers({\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\",\n          \"Authorization\": `Token ${token}`\n        }),\n        body: timeline.json()\n      });\n      if (response.ok) {\n        let json = await response.json();\n        console.debug(json);\n      } else {\n        console.debug(`Problem creating timeline: Server status ${response.status}, ${response.statusText}`);\n      }\n    }\n    if (saveReady) {\n      console.debug(\"Ready to post timeline\");\n      console.debug(timelineState);\n      postTimeline(currentUser, userToken, timelineState);\n      setSaveReady(false);\n      setUpdateTimelineList(true);\n      setHasUnsavedChanges(false);\n    } \n  }, [saveReady, timelineState, currentUser, userToken]);\n  \n\n  function DeleteTimelineButton() {\n    let [timelineToDelete, setTimelineToDelete] = useState(null);\n\n    function deleteTimeline() {\n      if (window.confirm(\"Are you sure you want to delete this quiz? All of its fact cards will be lost. This action cannot be undone.\")) {\n        console.debug(timelineID);\n        setTimelineToDelete(timelineID);\n      }\n    }\n\n    useEffect(() => {\n      async function requestDeletion(timelineID, token) {\n        let result = false;\n        let response = await fetch(`${User.SERVER}/timelines/${timelineID}/`, {\n          method: \"DELETE\",\n          headers: new Headers({\n            \"Accept\": \"application/json\",\n            \"Authorization\": `Token ${token}`\n          })\n        });\n        if (response.ok) {\n          let json = await response.json();\n          console.debug(json);\n          result = true;\n        } else {\n          console.debug(`Could not delete timeline with id ${timelineID}: Server status ${response.status}, ${response.statusText}`);\n          result = false;\n        }\n        return result;\n      }\n\n      if (timelineToDelete !== null) {\n        console.debug(`Deleting timeline with id ${timelineToDelete}`);\n\n        if (timelineID === \"create\") {\n          dispatchTimeline({ type: \"reset\" });\n        } else {\n          let deleted = requestDeletion(timelineToDelete, userToken);\n          if (deleted) {\n            dispatchTimeline({ type: \"reset\" });\n            setUpdateTimelineList(true);\n          }\n        }\n\n        setTimelineToDelete(null);\n      }\n    }, [timelineToDelete]);\n\n    let msg = (timelineID === \"create\") ? \"Reset Quiz\" : \"Delete Quiz\";\n    return(\n      <button id=\"deleteTimeline\" type=\"button\" onClick={deleteTimeline}>{ msg }</button>\n    );\n  }\n\n\n  function DiscardChangesButton() {\n    function discardChanges(event) {\n      setRefresh(true);\n    }\n\n    return(\n      <button type=\"button\" className={activeStyle(hasUnsavedChanges)} onClick={discardChanges}>Discard Changes</button>\n    );\n  }\n\n  function Controls() {\n    return(\n      <div className=\"controls\">\n        <SaveButton />\n        <DiscardChangesButton />\n        <DeleteTimelineButton />\n      </div>\n    );\n  }\n  let navigate = useNavigate();\n\n  if (authenticated) {\n    return(\n      <main>\n        <h1>Manage Your Quizzes</h1>\n        <Instructions />\n        <Chooser />\n        <MetadataPanel />\n        <CurrentFactsPanel />\n        <NewFactForm />\n        <Controls />\n      </main>\n    );\n  } else {\n    navigate(\"/login\");\n  }\n}\n\n"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,UAAU,CAAEC,SAAS,CAAEC,UAAU,KAAQ,OAAO,CACnE,OAASC,WAAW,KAAQ,kBAAkB,CAE9C,MAAO,CAAAC,IAAI,KAAM,iBAAiB,CAClC,MAAO,CAAAC,IAAI,KAAM,iBAAiB,CAClC,MAAO,CAAAC,QAAQ,KAAM,qBAAqB,CAE1C,MAAO,CAAAC,WAAW,KAAM,sBAAsB,CAE9C,MAAO,CAAAC,UAAU,KAAM,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,gCAAAC,QAAA,IAAAC,SAAA,yBACtC,KAAM,CAAAC,eAAe,CAAG,GAAI,CAAAT,QAAQ,CAAC,CACnCU,KAAK,CAAE,EAAE,CACTC,WAAW,CAAE,EAAE,CACfC,OAAO,CAAE,EAAE,CACXC,OAAO,CAAE,EAAE,CACXC,KAAK,CAAE,EACT,CAAC,CAAC,CAEF,QAAS,CAAAC,eAAeA,CAACC,KAAK,CAAEC,MAAM,CAAE,CACtC,GAAI,CAAAC,GAAG,CAAGD,MAAM,CAACE,OAAO,CAExB,GAAI,CAAAC,QAAQ,CAAG,IAAI,CAEnB,OAAOH,MAAM,CAACI,IAAI,EAChB,IAAK,KAAK,CACRD,QAAQ,CAAG,GAAI,CAAApB,QAAQ,CAAC,CAAE,GAAGgB,KAAK,CAAE,GAAGE,GAAI,CAAC,CAAC,CAC/C,MAEA,IAAK,OAAO,CACVE,QAAQ,CAAGX,eAAe,CAC5B,MAEA,IAAK,SAAS,CACZW,QAAQ,CAAGJ,KAAK,CAACM,OAAO,CAACJ,GAAG,CAACK,IAAI,CAAC,CACpC,MAEA,IAAK,YAAY,CACfH,QAAQ,CAAGJ,KAAK,CAACQ,UAAU,CAACN,GAAG,CAACK,IAAI,CAAC,CACvC,MAEA,IAAK,UAAU,CACbH,QAAQ,CAAGJ,KAAK,CAACS,QAAQ,CAACP,GAAG,CAAC,CAChC,MAEA,QACEE,QAAQ,CAAGJ,KAAK,CACpB,CAEA,MAAO,CAAAI,QAAQ,CACjB,CAGA,KAAM,CAAAM,WAAW,CAAG,GAAI,CAAA3B,IAAI,CAAC,CAC3B4B,IAAI,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAChBC,IAAI,CAAE,aAAa,CACnBC,GAAG,CAAE,+BACP,CAAC,CAAC,CAEF,QAAS,CAAAC,WAAWA,CAACf,KAAK,CAAEC,MAAM,CAAE,CAClC,GAAI,CAAAC,GAAG,CAAGD,MAAM,CAACE,OAAO,CACxB,GAAI,CAAAC,QAAQ,CAAG,IAAI,CAEnB,OAAOH,MAAM,CAACI,IAAI,EAChB,IAAK,KAAK,CACRD,QAAQ,CAAG,GAAI,CAAArB,IAAI,CAAC,CAAE,GAAGiB,KAAK,CAAE,GAAGE,GAAI,CAAC,CAAC,CAC3C,MAEA,IAAK,OAAO,CACVE,QAAQ,CAAGM,WAAW,CACxB,MAEA,QACEN,QAAQ,CAAGJ,KAAK,CACpB,CAAC,CAED,MAAO,CAAAI,QAAQ,CACjB,CAEA,QAAS,CAAAY,aAAaA,CAACC,UAAgC,CAAE,CACvD,MAAO,UACLC,KAAa,CAEP,IADN,CAAAC,UAA+B,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,IAAI,CAEtC,MAAO,UAASG,KAAK,CAAQ,CAC3B,GAAI,CAAAC,KAAK,CAAGD,KAAK,CAACE,MAAM,CAACD,KAAK,CAC9B,GAAI,CAAAE,QAAQ,CAAGP,UAAU,CAAGA,UAAU,CAACK,KAAK,CAAC,CAAGA,KAAK,CACrDP,UAAU,CAAC,CACTZ,IAAI,CAAE,KAAK,CACXF,OAAO,CAAE,CACP,CAACe,KAAK,EAAGQ,QACX,CACF,CAAC,CAAC,CACJ,CAAC,CACH,CAAC,CACH,CAGA,cAAe,SAAS,CAAAC,UAAUA,CAAA,CAAG,CACnC,GAAI,CAAAC,WAAW,CAAGlD,UAAU,CAACO,WAAW,CAAC,CACzC,GAAI,CAAA4C,aAAa,CAAGD,WAAW,CAACE,GAAG,CAACD,aAAa,CACjD,GAAI,CAAAE,WAAW,CAAKH,WAAW,CAACE,GAAG,CAACC,WAAW,CAC/C,GAAI,CAAAC,SAAS,CAAOJ,WAAW,CAACE,GAAG,CAACE,SAAS,CAE7C,GAAI,CAACC,aAAa,CAAEC,gBAAgB,CAAC,CAAGtD,UAAU,CAACmB,eAAe,CAAEN,eAAe,CAAC,CACpF,GAAI,CAAC0C,SAAS,CAAEC,YAAY,CAAC,CAAGxD,UAAU,CAACmC,WAAW,CAAEL,WAAW,CAAC,CAEpE,KAAM,CAAA2B,UAAU,CAAGrB,aAAa,CAACoB,YAAY,CAAC,CAC9C,KAAM,CAAAE,cAAc,CAAGtB,aAAa,CAACkB,gBAAgB,CAAC,CAEtD,GAAI,CAACK,eAAe,CAAEC,kBAAkB,CAAC,CAAG/D,QAAQ,CAACgB,eAAe,CAAC,CAErE,GAAI,CAACgD,SAAS,CAAEC,YAAY,CAAC,CAAGjE,QAAQ,CAAC,KAAK,CAAC,CAC/C,GAAI,CAACkE,kBAAkB,CAAEC,qBAAqB,CAAC,CAAGnE,QAAQ,CAAC,IAAI,CAAC,CAChE,GAAI,CAACoE,OAAO,CAAEC,UAAU,CAAC,CAAGrE,QAAQ,CAAC,IAAI,CAAC,CAE1C,QAAS,CAAAsE,WAAWA,CAACC,QAAQ,CAAE,CAC7B,MAAO,CAAAA,QAAQ,CAAG,QAAQ,CAAG,UAAU,CACzC,CAEA,GAAI,CAACC,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGzE,QAAQ,CAAC,KAAK,CAAC,CAE/DE,SAAS,CAAC,IAAM,CACd,GAAI,CAAAwE,MAAM,CAAKlB,aAAa,EAAIM,eAAe,EACpC,CAACN,aAAa,CAACmB,MAAM,CAACb,eAAe,CAAE,CAElD,GAAIA,eAAe,CAAE,CAAEc,OAAO,CAACC,KAAK,CAACf,eAAe,CAAC,CAAE,CACvD,GAAIN,aAAa,CAAE,CAAEoB,OAAO,CAACC,KAAK,CAACrB,aAAa,CAAC,CAAE,CAEnDiB,oBAAoB,CAACC,MAAM,CAAC,CAC9B,CAAC,CAAE,CAAClB,aAAa,CAAEM,eAAe,CAAC,CAAC,CAEpC,QAAS,CAAAgB,YAAYA,CAAA,CAAG,CACtB,mBACEnE,IAAA,MAAGoE,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,mDAAiD,CAAG,CAAC,CAErF,CAEA,GAAI,CAACC,YAAY,CAAEC,eAAe,CAAC,CAAGlF,QAAQ,CAAC,EAAE,CAAC,CAElDE,SAAS,CAAC,IAAM,CACd,cAAe,CAAAiF,gBAAgBA,CAACC,IAAI,CAAEC,KAAK,CAAE,CAC3C,GAAI,CAAAC,IAAI,CAAG,KAAM,CAAAF,IAAI,CAACG,oBAAoB,CAACF,KAAK,CAAC,CACjD,GAAIC,IAAI,CAAE,CACRJ,eAAe,CAACI,IAAI,CAAC,CACvB,CACF,CACA,GAAIlC,aAAa,EAAIc,kBAAkB,CAAE,CACvCiB,gBAAgB,CAAC7B,WAAW,CAAEC,SAAS,CAAC,CACxCY,qBAAqB,CAAC,KAAK,CAAC,CAC9B,CAAC,IAAM,CACLe,eAAe,CAAC,EAAE,CAAC,CACrB,CACF,CAAC,CAAE,CAAC9B,aAAa,CAAEc,kBAAkB,CAAEZ,WAAW,CAAEC,SAAS,CAAC,CAAC,CAE/D,GAAI,CAACiC,UAAU,CAAEC,aAAa,CAAC,CAAGzF,QAAQ,CAAC,IAAI,CAAC,CAEhDE,SAAS,CAAC,IAAM,CACd,cAAe,CAAAwF,YAAYA,CAACC,EAAE,CAAEN,KAAK,CAAE,CACrCT,OAAO,CAACC,KAAK,wBAAAe,MAAA,CAAwBJ,UAAU,CAAE,CAAC,CAClD,GAAI,CAAAK,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAF,MAAA,CAAIvF,IAAI,CAAC0F,MAAM,oBAAAH,MAAA,CAAkBD,EAAE,EAAI,CAC/DK,MAAM,CAAE,KAAK,CACbC,OAAO,CAAE,GAAI,CAAAC,OAAO,CAAC,CACnB,eAAe,UAAAN,MAAA,CAAWP,KAAK,CACjC,CAAC,CACH,CAAC,CAAC,CAEF,GAAIQ,QAAQ,CAACM,EAAE,CAAE,CACf,GAAI,CAAAC,IAAI,CAAG,KAAM,CAAAP,QAAQ,CAACO,IAAI,CAAC,CAAC,CAChCxB,OAAO,CAACC,KAAK,CAACuB,IAAI,CAAC,CACnB,GAAI,CAAAhF,OAAO,CAAIgF,IAAI,CAAChF,OAAO,GAAK,EAAE,CAClBkC,WAAW,CAAC+C,QAAQ,CACpBD,IAAI,CAAChF,OAAO,CAE5B,GAAI,CAAAkF,WAAW,CAAG,GAAI,CAAA/F,QAAQ,CAAC,CAC7BoF,EAAE,CAAYS,IAAI,CAACT,EAAE,CACrB1E,KAAK,CAASmF,IAAI,CAACnF,KAAK,CACxBC,WAAW,CAAGkF,IAAI,CAAClF,WAAW,CAC9BqF,QAAQ,CAAMhG,QAAQ,CAACiG,aAAa,CAACJ,IAAI,CAACG,QAAQ,CAAC,CACnDnF,OAAO,CAAOA,OAAO,CACrBC,KAAK,CAAS+E,IAAI,CAAC/E,KAAK,CAACoF,GAAG,CAACC,CAAC,EAAIpG,IAAI,CAACqG,WAAW,CAACD,CAAC,CAAC,CACvD,CAAC,CAAC,CAEFjD,gBAAgB,CAAC,CACf7B,IAAI,CAAE,KAAK,CACXF,OAAO,CAAE4E,WACX,CAAC,CAAC,CAEFvC,kBAAkB,CAACuC,WAAW,CAAC,CAEjC,CAAC,IAAM,CACL1B,OAAO,CAACC,KAAK,qCAAAe,MAAA,CAAqCD,EAAE,qBAAAC,MAAA,CAAmBC,QAAQ,CAACnB,MAAM,OAAAkB,MAAA,CAAKC,QAAQ,CAACe,UAAU,CAAE,CAAC,CACnH,CACF,CAEA,GAAIpB,UAAU,CAAE,CACd,GAAI,CAAChB,iBAAiB,EAAIqC,MAAM,CAACC,OAAO,CAAC,wFAAwF,CAAC,CAAE,CAClI,GAAItB,UAAU,GAAK,QAAQ,CAAE,CAC3B/B,gBAAgB,CAAC,CAAE7B,IAAI,CAAE,OAAQ,CAAC,CAAC,CACrC,CAAC,IAAM,CACL8D,YAAY,CAACF,UAAU,CAAEjC,SAAS,CAAC,CACrC,CACAY,qBAAqB,CAAC,IAAI,CAAC,CAC3BE,UAAU,CAAC,KAAK,CAAC,CACjBI,oBAAoB,CAAC,KAAK,CAAC,CAC7B,CACF,CACF,CAAC,CAAE,CAACe,UAAU,CAAElC,WAAW,CAAC+C,QAAQ,CAAE9C,SAAS,CAAEa,OAAO,CAAC,CAAC,CAG1D,QAAS,CAAA2C,OAAOA,CAAA,CAAG,CACjB,QAAS,CAAArB,YAAYA,CAAC5C,KAAK,CAAE,CAC3BA,KAAK,CAACkE,cAAc,CAAC,CAAC,CACtB,GAAI,CAAAC,IAAI,CAAG,GAAI,CAAAC,QAAQ,CAACpE,KAAK,CAACE,MAAM,CAAC,CACrC,GAAI,CAAA2C,EAAE,CAAGsB,IAAI,CAAC5D,GAAG,CAAC,iBAAiB,CAAC,CACpC;AACAoC,aAAa,CAACE,EAAE,CAAC,CACnB,CAEA,QAAS,CAAAwB,cAAcA,CAACC,QAAQ,CAAE,CAChC,mBACEzG,IAAA,WAA0BoC,KAAK,CAAEqE,QAAQ,CAACzB,EAAG,CAAAX,QAAA,CAAEoC,QAAQ,CAACnG,KAAK,EAAhDmG,QAAQ,CAACzB,EAAgD,CAAC,CAE3E,CAEA,GAAI,CAAC0B,wBAAwB,CAAEC,2BAA2B,CAAC,CAAGtH,QAAQ,CAAC,QAAQ,CAAC,CAEhF,QAAS,CAAAuH,eAAeA,CAACzE,KAAK,CAAE,CAC9BwE,2BAA2B,CAACxE,KAAK,CAACE,MAAM,CAACD,KAAK,CAAC,CACjD,CAEA,GAAI,CAAAyE,cAAc,CAAIH,wBAAwB,GAAK,QAAQ,CACnC,QAAQ,CAAG,MAAM,CAEzC,mBACExG,KAAA,SAAM8E,EAAE,CAAC,SAAS,CAAC8B,QAAQ,CAAE/B,YAAa,CAAAV,QAAA,eACxCrE,IAAA,UAAO+G,OAAO,CAAC,iBAAiB,CAAA1C,QAAA,CAAC,oBAAkB,CAAO,CAAC,cAC3DnE,KAAA,WAAQ8G,IAAI,CAAC,iBAAiB,CAACC,YAAY,CAAC,QAAQ,CAACC,QAAQ,CAAEN,eAAgB,CAAAvC,QAAA,eAC7ErE,IAAA,WAAQoC,KAAK,CAAC,QAAQ,CAAAiC,QAAA,CAAC,YAAU,CAAQ,CAAC,CACxCC,YAAY,CAACwB,GAAG,CAACU,cAAc,CAAC,EAC5B,CAAC,cACTxG,IAAA,WAAQiB,IAAI,CAAC,QAAQ,CAAAoD,QAAA,CAAGwC,cAAc,CAAU,CAAC,EAC7C,CAAC,CAEX,CAEA,QAAS,CAAAM,aAAaA,CAAA,CAAG,CACvB,GAAI,CAAA1G,OAAO,CAAIoC,aAAa,CAACpC,OAAO,GAAK,EAAE,CAC3BkC,WAAW,CAAC+C,QAAQ,CACpB7C,aAAa,CAACpC,OAAO,CAErC,mBACEP,KAAA,YAAS8E,EAAE,CAAC,UAAU,CAAAX,QAAA,eACpBrE,IAAA,OAAAqE,QAAA,CAAI,UAAQ,CAAI,CAAC,cACjBrE,IAAA,SAAMoE,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC7BnE,KAAA,QAAKkE,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BnE,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,UAAO+G,OAAO,CAAC,OAAO,CAAA1C,QAAA,CAAC,OAAK,CAAO,CAAC,cACpCrE,IAAA,UAAOiB,IAAI,CAAC,MAAM,CAAC+F,IAAI,CAAC,OAAO,CAC7BI,MAAM,CAAElE,cAAc,CAAC,OAAO,CAAE,CAChC+D,YAAY,CAAEpE,aAAa,CAACvC,KAAM,CAAE,CAAC,EACpC,CAAC,cACNJ,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,UAAO+G,OAAO,CAAC,aAAa,CAAA1C,QAAA,CAAC,aAAW,CAAO,CAAC,cAChDrE,IAAA,UAAOiB,IAAI,CAAC,MAAM,CAAC+F,IAAI,CAAC,aAAa,CACnCI,MAAM,CAAElE,cAAc,CAAC,aAAa,CAAE,CACtC+D,YAAY,CAAEpE,aAAa,CAACtC,WAAY,CAAE,CAAC,EAC1C,CAAC,cACNL,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,UAAO+G,OAAO,CAAC,UAAU,CAAA1C,QAAA,CAAC,sCAAoC,CAAO,CAAC,cACtErE,IAAA,UAAOiB,IAAI,CAAC,MAAM,CAAC+F,IAAI,CAAC,UAAU,CAChCI,MAAM,CAAElE,cAAc,CAAC,UAAU,CAAEtD,QAAQ,CAACiG,aAAa,CAAE,CAC3DoB,YAAY,CAAEpE,aAAa,CAACwE,aAAc,CAAE,CAAC,EAC5C,CAAC,cACNnH,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,UAAO+G,OAAO,CAAC,SAAS,CAAA1C,QAAA,CAAC,sDAAoD,CAAO,CAAC,cACrFrE,IAAA,UAAOiB,IAAI,CAAC,MAAM,CAAC+F,IAAI,CAAC,SAAS,CAC/BI,MAAM,CAAElE,cAAc,CAAC,SAAS,CAAE,CAClC+D,YAAY,CAAExG,OAAQ,CAAC,CAAC,EACvB,CAAC,EACH,CAAC,CACF,CAAC,EACA,CAAC,CAEd,CAEA,QAAS,CAAA6G,iBAAiBA,CAAA,CAAG,CAC3B,QAAS,CAAAC,WAAWA,CAACC,IAAI,CAAE,CACzB,QAAS,CAAAC,UAAUA,CAACtF,KAAK,CAAE,CACzB,GAAI+D,MAAM,CAACC,OAAO,CAAC,mDAAmD,CAAC,CAAE,CACvElC,OAAO,CAACC,KAAK,sBAAAe,MAAA,CAAsBuC,IAAI,CAACjG,IAAI,CAACmG,WAAW,CAAC,CAAC,KAAG,CAAC,CAC9D5E,gBAAgB,CAAC,CACf7B,IAAI,CAAE,YAAY,CAClBF,OAAO,CAAE,CAAEI,IAAI,CAAEqG,IAAK,CACxB,CAAC,CAAC,CACJ,CACF,CAEA,QAAS,CAAAG,QAAQA,CAACxF,KAAK,CAAE,CACvB8B,OAAO,CAACC,KAAK,oBAAAe,MAAA,CAAoBuC,IAAI,CAACjG,IAAI,CAACmG,WAAW,CAAC,CAAC,KAAG,CAAC,CAC5D1E,YAAY,CAAC,CACX/B,IAAI,CAAE,KAAK,CACXF,OAAO,CAAEyG,IACX,CAAC,CAAC,CACF1E,gBAAgB,CAAC,CACf7B,IAAI,CAAE,YAAY,CAClBF,OAAO,CAAE,CAAEI,IAAI,CAAEqG,IAAK,CACxB,CAAC,CAAC,CACJ,CAEA,mBACEtH,KAAA,OAAAmE,QAAA,eACErE,IAAA,OAAAqE,QAAA,cACEnE,KAAA,QAAKkE,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/BrE,IAAA,WAAQiB,IAAI,CAAC,QAAQ,CAAC2G,OAAO,CAAED,QAAS,CAAAtD,QAAA,CAAC,MAAI,CAAQ,CAAC,cACtDrE,IAAA,WAAQiB,IAAI,CAAC,QAAQ,CAAC2G,OAAO,CAAEH,UAAW,CAAApD,QAAA,CAAC,QAAM,CAAQ,CAAC,EACvD,CAAC,CACJ,CAAC,cACLrE,IAAA,OAAAqE,QAAA,CAAKwD,MAAM,CAACL,IAAI,CAACM,IAAI,CAAC,CAAK,CAAC,cAC5B9H,IAAA,OAAAqE,QAAA,CAAKmD,IAAI,CAAC/F,IAAI,CAAK,CAAC,cACpBzB,IAAA,OAAAqE,QAAA,CAAKmD,IAAI,CAAC9F,GAAG,CAAK,CAAC,GATZqG,MAAM,CAACC,UAAU,CAAC,CAUvB,CAAC,CAET,CAEA,QAAS,CAAA7D,YAAYA,CAAA,CAAG,CACtB,mBACEjE,KAAA,CAAAE,SAAA,EAAAiE,QAAA,eACErE,IAAA,MAAGoE,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,yEAAuE,CAAG,CAAC,cACvGrE,IAAA,CAACF,UAAU,EAACmI,QAAQ,CAAEnF,gBAAiB,CAAE,CAAC,EAC1C,CAAC,CAEP,CAEA,mBACE5C,KAAA,YAAS8E,EAAE,CAAC,iBAAiB,CAAAX,QAAA,eAC3BrE,IAAA,OAAAqE,QAAA,CAAI,yBAAuB,CAAI,CAAC,cAChCrE,IAAA,CAACmE,YAAY,GAAE,CAAC,cAChBjE,KAAA,UAAOkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACzBrE,IAAA,UAAAqE,QAAA,cACEnE,KAAA,OAAAmE,QAAA,eACErE,IAAA,OAAAqE,QAAA,CAAI,UAAQ,CAAI,CAAC,cACjBrE,IAAA,OAAAqE,QAAA,CAAI,MAAI,CAAI,CAAC,cACbrE,IAAA,OAAAqE,QAAA,CAAI,aAAW,CAAI,CAAC,cACpBrE,IAAA,OAAAqE,QAAA,CAAI,WAAS,CAAI,CAAC,EAChB,CAAC,CACA,CAAC,cACRrE,IAAA,UAAAqE,QAAA,CACIxB,aAAa,CAACnC,KAAK,CAACoF,GAAG,CAACyB,WAAW,CAAC,CACjC,CAAC,EACH,CAAC,EACD,CAAC,CAEd,CAEA,QAAS,CAAAW,WAAWA,CAAA,CAAG,CAErB,QAAS,CAAAC,OAAOA,CAAChG,KAAK,CAAE,CACtB,GAAIY,SAAS,CAACxB,IAAI,EAAIwB,SAAS,CAACtB,IAAI,CAAE,CACpCqB,gBAAgB,CAAC,CACf7B,IAAI,CAAE,SAAS,CACfF,OAAO,CAAE,CAAEI,IAAI,CAAE4B,SAAU,CAC7B,CAAC,CAAC,CACFkB,OAAO,CAACC,KAAK,CAAC,wBAAwB,CAAC,CACvClB,YAAY,CAAC,CAAE/B,IAAI,CAAE,OAAQ,CAAC,CAAC,CACjC,CACF,CAEA,QAAS,CAAAmH,WAAWA,CAAAC,IAAA,CAAW,IAAV,CAAElH,IAAK,CAAC,CAAAkH,IAAA,CAC3B,mBACEnI,KAAA,QAAKkE,SAAS,CAAC,MAAM,CAAC,YAAWrB,SAAS,CAAC+E,IAAK,CAAC,gBAAc,UAAU,CAAAzD,QAAA,eACvErE,IAAA,SAAMoE,SAAS,CAAC,MAAM,CAAAC,QAAA,CAAEtB,SAAS,CAAC+E,IAAI,CAAO,CAAC,cAC9C9H,IAAA,QAAKsI,GAAG,CAAEvF,SAAS,CAACrB,GAAI,CAAC6G,GAAG,CAAExF,SAAS,CAACrB,GAAI,CAAE,CAAC,cAC/C1B,IAAA,SAAMoE,SAAS,CAAC,MAAM,CAAAC,QAAA,CAAEtB,SAAS,CAACtB,IAAI,CAAO,CAAC,EAC3C,CAAC,CAEV,CAGA,QAAS,CAAA+G,YAAYA,CAACV,IAAY,CAAQ,CACxC,GAAI,CAAAvG,IAAI,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CACrBD,IAAI,CAACkH,WAAW,CAACX,IAAI,CAAC,CACtB,MAAO,CAAAvG,IAAI,CACb,CAEA,mBACErB,KAAA,YAAS8E,EAAE,CAAC,KAAK,CAAAX,QAAA,eACfrE,IAAA,OAAAqE,QAAA,CAAI,cAAY,CAAI,CAAC,cACrBnE,KAAA,SAAM8E,EAAE,CAAC,aAAa,CAAAX,QAAA,eACpBnE,KAAA,QAAKkE,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BnE,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,UAAO+G,OAAO,CAAC,MAAM,CAAA1C,QAAA,CAAC,MAAI,CAAO,CAAC,cAClCrE,IAAA,UACEiB,IAAI,CAAC,QAAQ,CACb+F,IAAI,CAAC,MAAM,CACX0B,GAAG,CAAEpH,WAAW,CAACwG,IAAK,CACtBZ,QAAQ,CAAEjE,UAAU,CAAC,MAAM,CAAEuF,YAAY,CAAE,CAC3CvB,YAAY,CAAElE,SAAS,CAAC+E,IAAK,CAAE,CAAC,EAC/B,CAAC,cACN5H,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,UAAO+G,OAAO,CAAC,MAAM,CAAA1C,QAAA,CAAC,sBAAoB,CAAO,CAAC,cAClDrE,IAAA,UACEiB,IAAI,CAAC,MAAM,CACX+F,IAAI,CAAC,MAAM,CACXI,MAAM,CAAEnE,UAAU,CAAC,MAAM,CAAE,CAC3BgE,YAAY,CAAElE,SAAS,CAACtB,IAAK,CAAE,CAAC,EAC/B,CAAC,cACNvB,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,UAAO+G,OAAO,CAAC,KAAK,CAAA1C,QAAA,CAAC,kCAAgC,CAAO,CAAC,cAC7DrE,IAAA,UACEiB,IAAI,CAAC,KAAK,CACV+F,IAAI,CAAC,KAAK,CACVI,MAAM,CAAEnE,UAAU,CAAC,KAAK,CAAE,CAC1BgE,YAAY,CAAElE,SAAS,CAACrB,GAAI,CAAE,CAAC,EAC9B,CAAC,EACH,CAAC,cACNxB,KAAA,YAAS8E,EAAE,CAAC,SAAS,CAAAX,QAAA,eACnBrE,IAAA,OAAAqE,QAAA,CAAI,SAAO,CAAI,CAAC,cAChBrE,IAAA,CAACoI,WAAW,EAACjH,IAAI,CAAE4B,SAAU,CAAE,CAAC,EACzB,CAAC,cACV/C,IAAA,WAAQiB,IAAI,CAAC,QAAQ,CAAC+D,EAAE,CAAC,KAAK,CAAC4C,OAAO,CAAEO,OAAQ,CAAA9D,QAAA,CAAC,KAAG,CAAQ,CAAC,EACzD,CAAC,EACA,CAAC,CAEd,CAGA,QAAS,CAAAsE,UAAUA,CAAA,CAAG,CACpB,mBACE3I,IAAA,WAAQoE,SAAS,CAAET,WAAW,CAACE,iBAAiB,CAAE,CAACmB,EAAE,CAAC,MAAM,CAAC/D,IAAI,CAAC,QAAQ,CAAC2G,OAAO,CAAEgB,YAAa,CAAAvE,QAAA,CAAC,MAAI,CAAQ,CAAC,CAEnH,CAGA;AACA;AACA,QAAS,CAAAuE,YAAYA,CAACzG,KAAK,CAAE,CAC3B,GAAI,CAAAtB,MAAM,CAAGgC,aAAa,CAAG,SAAS,CAAG,SAAS,CAClDoB,OAAO,CAACC,KAAK,IAAAe,MAAA,CAAIpE,MAAM,2BAAAoE,MAAA,CAAyBpC,aAAa,CAACvC,KAAK,KAAG,CAAC,CACvEgD,YAAY,CAAC,IAAI,CAAC,CACpB,CAEA/D,SAAS,CAAC,IAAM,CACd,cAAe,CAAAsJ,YAAYA,CAACpE,IAAI,CAAEC,KAAK,CAAE+B,QAAQ,CAAE,CACjDxC,OAAO,CAACC,KAAK,CAACuC,QAAQ,CAAC/F,KAAK,CAAC,CAC7BuD,OAAO,CAACC,KAAK,CAACuC,QAAQ,CAAChB,IAAI,CAAC,CAAC,CAAC,CAC9B,GAAI,CAAAP,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAF,MAAA,CAAIvF,IAAI,CAAC0F,MAAM,oBAAmB,CAC1DC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,GAAI,CAAAC,OAAO,CAAC,CACnB,cAAc,CAAE,kBAAkB,CAClC,QAAQ,CAAE,kBAAkB,CAC5B,eAAe,UAAAN,MAAA,CAAWP,KAAK,CACjC,CAAC,CAAC,CACFoE,IAAI,CAAErC,QAAQ,CAAChB,IAAI,CAAC,CACtB,CAAC,CAAC,CACF,GAAIP,QAAQ,CAACM,EAAE,CAAE,CACf,GAAI,CAAAC,IAAI,CAAG,KAAM,CAAAP,QAAQ,CAACO,IAAI,CAAC,CAAC,CAChCxB,OAAO,CAACC,KAAK,CAACuB,IAAI,CAAC,CACrB,CAAC,IAAM,CACLxB,OAAO,CAACC,KAAK,6CAAAe,MAAA,CAA6CC,QAAQ,CAACnB,MAAM,OAAAkB,MAAA,CAAKC,QAAQ,CAACe,UAAU,CAAE,CAAC,CACtG,CACF,CACA,GAAI5C,SAAS,CAAE,CACbY,OAAO,CAACC,KAAK,CAAC,wBAAwB,CAAC,CACvCD,OAAO,CAACC,KAAK,CAACrB,aAAa,CAAC,CAC5BgG,YAAY,CAAClG,WAAW,CAAEC,SAAS,CAAEC,aAAa,CAAC,CACnDS,YAAY,CAAC,KAAK,CAAC,CACnBE,qBAAqB,CAAC,IAAI,CAAC,CAC3BM,oBAAoB,CAAC,KAAK,CAAC,CAC7B,CACF,CAAC,CAAE,CAACT,SAAS,CAAER,aAAa,CAAEF,WAAW,CAAEC,SAAS,CAAC,CAAC,CAGtD,QAAS,CAAAmG,oBAAoBA,CAAA,CAAG,CAC9B,GAAI,CAACC,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG5J,QAAQ,CAAC,IAAI,CAAC,CAE5D,QAAS,CAAA6J,cAAcA,CAAA,CAAG,CACxB,GAAIhD,MAAM,CAACC,OAAO,CAAC,8GAA8G,CAAC,CAAE,CAClIlC,OAAO,CAACC,KAAK,CAACW,UAAU,CAAC,CACzBoE,mBAAmB,CAACpE,UAAU,CAAC,CACjC,CACF,CAEAtF,SAAS,CAAC,IAAM,CACd,cAAe,CAAA4J,eAAeA,CAACtE,UAAU,CAAEH,KAAK,CAAE,CAChD,GAAI,CAAA0E,MAAM,CAAG,KAAK,CAClB,GAAI,CAAAlE,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAF,MAAA,CAAIvF,IAAI,CAAC0F,MAAM,gBAAAH,MAAA,CAAcJ,UAAU,MAAK,CACpEQ,MAAM,CAAE,QAAQ,CAChBC,OAAO,CAAE,GAAI,CAAAC,OAAO,CAAC,CACnB,QAAQ,CAAE,kBAAkB,CAC5B,eAAe,UAAAN,MAAA,CAAWP,KAAK,CACjC,CAAC,CACH,CAAC,CAAC,CACF,GAAIQ,QAAQ,CAACM,EAAE,CAAE,CACf,GAAI,CAAAC,IAAI,CAAG,KAAM,CAAAP,QAAQ,CAACO,IAAI,CAAC,CAAC,CAChCxB,OAAO,CAACC,KAAK,CAACuB,IAAI,CAAC,CACnB2D,MAAM,CAAG,IAAI,CACf,CAAC,IAAM,CACLnF,OAAO,CAACC,KAAK,sCAAAe,MAAA,CAAsCJ,UAAU,qBAAAI,MAAA,CAAmBC,QAAQ,CAACnB,MAAM,OAAAkB,MAAA,CAAKC,QAAQ,CAACe,UAAU,CAAE,CAAC,CAC1HmD,MAAM,CAAG,KAAK,CAChB,CACA,MAAO,CAAAA,MAAM,CACf,CAEA,GAAIJ,gBAAgB,GAAK,IAAI,CAAE,CAC7B/E,OAAO,CAACC,KAAK,8BAAAe,MAAA,CAA8B+D,gBAAgB,CAAE,CAAC,CAE9D,GAAInE,UAAU,GAAK,QAAQ,CAAE,CAC3B/B,gBAAgB,CAAC,CAAE7B,IAAI,CAAE,OAAQ,CAAC,CAAC,CACrC,CAAC,IAAM,CACL,GAAI,CAAAoI,OAAO,CAAGF,eAAe,CAACH,gBAAgB,CAAEpG,SAAS,CAAC,CAC1D,GAAIyG,OAAO,CAAE,CACXvG,gBAAgB,CAAC,CAAE7B,IAAI,CAAE,OAAQ,CAAC,CAAC,CACnCuC,qBAAqB,CAAC,IAAI,CAAC,CAC7B,CACF,CAEAyF,mBAAmB,CAAC,IAAI,CAAC,CAC3B,CACF,CAAC,CAAE,CAACD,gBAAgB,CAAC,CAAC,CAEtB,GAAI,CAAAM,GAAG,CAAIzE,UAAU,GAAK,QAAQ,CAAI,YAAY,CAAG,aAAa,CAClE,mBACE7E,IAAA,WAAQgF,EAAE,CAAC,gBAAgB,CAAC/D,IAAI,CAAC,QAAQ,CAAC2G,OAAO,CAAEsB,cAAe,CAAA7E,QAAA,CAAGiF,GAAG,CAAU,CAAC,CAEvF,CAGA,QAAS,CAAAC,oBAAoBA,CAAA,CAAG,CAC9B,QAAS,CAAAC,cAAcA,CAACrH,KAAK,CAAE,CAC7BuB,UAAU,CAAC,IAAI,CAAC,CAClB,CAEA,mBACE1D,IAAA,WAAQiB,IAAI,CAAC,QAAQ,CAACmD,SAAS,CAAET,WAAW,CAACE,iBAAiB,CAAE,CAAC+D,OAAO,CAAE4B,cAAe,CAAAnF,QAAA,CAAC,iBAAe,CAAQ,CAAC,CAEtH,CAEA,QAAS,CAAAoF,QAAQA,CAAA,CAAG,CAClB,mBACEvJ,KAAA,QAAKkE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrE,IAAA,CAAC2I,UAAU,GAAE,CAAC,cACd3I,IAAA,CAACuJ,oBAAoB,GAAE,CAAC,cACxBvJ,IAAA,CAAC+I,oBAAoB,GAAE,CAAC,EACrB,CAAC,CAEV,CACA,GAAI,CAAAW,QAAQ,CAAGjK,WAAW,CAAC,CAAC,CAE5B,GAAIgD,aAAa,CAAE,CACjB,mBACEvC,KAAA,SAAAmE,QAAA,eACErE,IAAA,OAAAqE,QAAA,CAAI,qBAAmB,CAAI,CAAC,cAC5BrE,IAAA,CAACmE,YAAY,GAAE,CAAC,cAChBnE,IAAA,CAACoG,OAAO,GAAE,CAAC,cACXpG,IAAA,CAACmH,aAAa,GAAE,CAAC,cACjBnH,IAAA,CAACsH,iBAAiB,GAAE,CAAC,cACrBtH,IAAA,CAACkI,WAAW,GAAE,CAAC,cACflI,IAAA,CAACyJ,QAAQ,GAAE,CAAC,EACR,CAAC,CAEX,CAAC,IAAM,CACLC,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}