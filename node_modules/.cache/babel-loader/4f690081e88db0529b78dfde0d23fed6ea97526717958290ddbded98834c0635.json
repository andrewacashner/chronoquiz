{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useContext } from \"react\";\nimport Card from \"../classes/Card\";\nimport FactList from \"../classes/FactList\";\nimport Game from \"../classes/Game\";\nimport TimelineContext from \"../store/TimelineContext\";\nlet [clues, setClues] = useState(new FactList());\nfunction userUploadUrl(files) {\n  return URL.createObjectURL(files[0]);\n}\nfunction getInputUrl(source, files) {\n  let url = \"\";\n  if (source) {\n    if (files.length > 0) {\n      url = userUploadUrl(files);\n    } else {\n      url = `input/${source}.json`;\n    }\n  }\n  return url;\n}\nasync function cardArrayFromJson(json) {\n  let cards = [];\n  for (let entry of json) {\n    try {\n      let validCard = await Card.newSafeCard(entry);\n      if (validCard && validCard.isSafe) {\n        cards.push(validCard);\n      } else {\n        throw new Error(`Faulty card input {date: ${entry.date}, info: ${entry.info}}; skipping`);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  return cards;\n}\nasync function loadTimeline(url) {\n  if (url) {\n    console.log(`Loading file ${url}`);\n    let cards = [];\n    let response = await fetch(url).catch(e => {\n      console.error(e);\n      return cards;\n    });\n    let data = await response.json().catch(e => {\n      console.error(e);\n      return cards;\n    });\n    cards = await cardArrayFromJson(data).catch(e => {\n      console.error(e);\n      throw new Error(\"Could not create cards from JSON input\");\n    });\n    return new FactList(cards);\n  }\n}\nfunction useTimelineSelection(event) {\n  _s();\n  let context = useContext(TimelineContext);\n  let setGame = context.set;\n  let files = event.currentTarget.fileInput.files;\n  let source = event.currentTarget.source.value;\n  let url = getInputUrl(source, files);\n  let cards = useEffect(() => loadTimeline(url), []);\n  setGame(prevGame => new Game(cards));\n}\n_s(useTimelineSelection, \"xNhfAC56gIwB6cEP3FPthp+aVw0=\");\nexport default useTimelineSelection;","map":{"version":3,"names":["useState","useContext","Card","FactList","Game","TimelineContext","clues","setClues","userUploadUrl","files","URL","createObjectURL","getInputUrl","source","url","length","cardArrayFromJson","json","cards","entry","validCard","newSafeCard","isSafe","push","Error","date","info","e","console","error","loadTimeline","log","response","fetch","catch","data","useTimelineSelection","event","_s","context","setGame","set","currentTarget","fileInput","value","useEffect","prevGame"],"sources":["/home/andrewacashner/Documents/computing/javascript/react/chronoquiz/src/hooks/useTimelineSelection.tsx"],"sourcesContent":["import { useState, useContext } from \"react\";\nimport Card from \"../classes/Card\";\nimport FactList from \"../classes/FactList\";\nimport Game from \"../classes/Game\";\nimport TimelineContext from \"../store/TimelineContext\";\n\nlet [clues, setClues] = useState(new FactList());\n\nfunction userUploadUrl(files: FileList): string {\n  return URL.createObjectURL(files[0]);\n}\n\nfunction getInputUrl(source: string, files: FileList): string {\n  let url = \"\";\n  if (source) {\n    if (files.length > 0) {\n      url = userUploadUrl(files);\n      } else {\n        url = `input/${source}.json`;\n      }\n  }\n  return url;\n}\n\nasync function cardArrayFromJson(json: Array<{date, info}>): Array<Card> {\n  let cards = [];\n  for (let entry of json) {\n    try {\n      let validCard = await Card.newSafeCard(entry);\n      if (validCard && validCard.isSafe) {\n        cards.push(validCard);\n      } else {\n        throw new Error(`Faulty card input {date: ${entry.date}, info: ${entry.info}}; skipping`);\n      } \n    } catch(e) {\n      console.error(e);\n    }\n  }\n  return cards;\n}\n\nasync function loadTimeline(url: string): FactList {\n  if (url) {\n    console.log(`Loading file ${url}`);\n    let cards = [];\n\n    let response = await fetch(url).catch(e => {\n      console.error(e);\n      return cards;\n    });\n\n    let data = await response.json().catch(e => {\n      console.error(e);\n      return cards;\n    });\n\n    cards = await cardArrayFromJson(data).catch(e => {\n      console.error(e);\n      throw new Error(\"Could not create cards from JSON input\");\n    });\n\n    return new FactList(cards);\n  }\n}\n\nfunction useTimelineSelection(event: React.FormEvent<HTMLFormElement>):  void {\n  let context = useContext(TimelineContext);\n  let setGame = context.set;\n\n  let files = event.currentTarget.fileInput.files as FileList;\n  let source = event.currentTarget.source.value as string;\n  let url = getInputUrl(source, files);\n\n  let cards = useEffect(() => loadTimeline(url), []);\n\n  setGame(prevGame => new Game(cards));\n}\n\nexport default useTimelineSelection;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}