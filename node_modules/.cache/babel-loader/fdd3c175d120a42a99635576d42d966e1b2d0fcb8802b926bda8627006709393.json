{"ast":null,"code":"var _s = $RefreshSig$(),\n  _s4 = $RefreshSig$();\nimport { useState, useEffect } from \"react\";\nimport Card from \"../classes/Card\";\nimport FactList from \"../classes/FactList\";\nimport Game from \"../classes/Game\";\nfunction userUploadUrl(files) {\n  return URL.createObjectURL(files[0]);\n}\nfunction getInputUrl(source, files) {\n  let url = \"\";\n  if (source) {\n    if (files.length > 0) {\n      url = userUploadUrl(files);\n    } else {\n      url = `input/${source}.json`;\n    }\n  }\n  return url;\n}\nasync function cardArrayFromJson(json) {\n  let cards = [];\n  for (let entry of json) {\n    try {\n      let validCard = await Card.newSafeCard(entry);\n      if (validCard && validCard.isSafe) {\n        cards.push(validCard);\n      } else {\n        throw new Error(`Faulty card input {date: ${entry.date}, info: ${entry.info}}; skipping`);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  return cards;\n}\nfunction useUrl(event = null, setGameFn) {\n  _s();\n  let [cards, setCards] = useState([]);\n  if (event) {\n    let files = event.currentTarget.fileInput.files;\n    let source = event.currentTarget.source.value;\n    let url = getInputUrl(source, files);\n    console.log(`Loading file ${url}`);\n    useEffect(function () {\n      fetch(url).then(function (response) {\n        let json = response.json();\n        let cardArray = cardArrayFromJson(json);\n        setCards(prev => cardArray);\n      }).catch(e => {\n        console.error(e);\n        throw new Error(\"Could not create cards from JSON input\");\n      });\n    }, [cards]);\n    if (cards) {\n      let cardList = new FactList(cards);\n      setGameFn(prev => new Game(cardList));\n    }\n  }\n}\n\n// TODO doesn't work\n// TODO return type\n_s(useUrl, \"M51NroWgc5aUEHiqsZiaQ+7WeWA=\");\nfunction useTimelineSelection(event, setGameFn) {\n  _s4();\n  useEffect(() => {\n    var _s2 = $RefreshSig$();\n    async function load() {\n      _s2();\n      useUrl(event, setGameFn).catch(e => console.log(e));\n    }\n    _s2(load, \"nSNTZEfKC+VsEzIna4YCf5+knV0=\", false, function () {\n      return [useUrl];\n    });\n    load();\n  }, [event, setGameFn]);\n  return (event, setGameFn) => {\n    var _s3 = $RefreshSig$();\n    async function load() {\n      _s3();\n      useUrl(event, setGameFn).catch(e => console.log(e));\n    }\n    _s3(load, \"nSNTZEfKC+VsEzIna4YCf5+knV0=\", false, function () {\n      return [useUrl];\n    });\n    load();\n  };\n}\n_s4(useTimelineSelection, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\nexport default useTimelineSelection;","map":{"version":3,"names":["useState","useEffect","Card","FactList","Game","userUploadUrl","files","URL","createObjectURL","getInputUrl","source","url","length","cardArrayFromJson","json","cards","entry","validCard","newSafeCard","isSafe","push","Error","date","info","e","console","error","useUrl","event","setGameFn","_s","setCards","currentTarget","fileInput","value","log","fetch","then","response","cardArray","prev","catch","cardList","useTimelineSelection","_s4","_s2","$RefreshSig$","load","_s3"],"sources":["/home/andrewacashner/Documents/computing/javascript/react/chronoquiz/src/hooks/useTimelineSelection.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport Card from \"../classes/Card\";\nimport FactList from \"../classes/FactList\";\nimport Game from \"../classes/Game\";\n\nfunction userUploadUrl(files: FileList): string {\n  return URL.createObjectURL(files[0]);\n}\n\nfunction getInputUrl(source: string, files: FileList): string {\n  let url = \"\";\n  if (source) {\n    if (files.length > 0) {\n      url = userUploadUrl(files);\n    } else {\n      url = `input/${source}.json`;\n    }\n  }\n  return url;\n}\n\nasync function cardArrayFromJson(json: Array<{date, info}>): Array<Card> {\n  let cards = [];\n  for (let entry of json) {\n    try {\n      let validCard = await Card.newSafeCard(entry);\n      if (validCard && validCard.isSafe) {\n        cards.push(validCard);\n      } else {\n        throw new Error(`Faulty card input {date: ${entry.date}, info: ${entry.info}}; skipping`);\n      } \n    } catch(e) {\n      console.error(e);\n    }\n  }\n  return cards;\n}\n\nfunction useUrl(\n  event: React.FormEvent<HTMLFormElement> = null,\n  setGameFn: (Game) => void\n): void {\n\n  let [cards, setCards] = useState([]);\n\n  if (event) {\n    let files = event.currentTarget.fileInput.files as FileList;\n    let source = event.currentTarget.source.value as string;\n    let url = getInputUrl(source, files);\n\n    console.log(`Loading file ${url}`);\n    useEffect(function () {\n      fetch(url).then(\n        function (response) {\n          let json = response.json();\n          let cardArray = cardArrayFromJson(json);\n          setCards(prev => cardArray);\n        }).catch(e => {\n          console.error(e)\n          throw new Error(\"Could not create cards from JSON input\");\n        })\n    }, [cards]);\n\n    if (cards) {\n      let cardList = new FactList(cards);\n      setGameFn(prev => new Game(cardList));\n    }\n  }\n}\n\n// TODO doesn't work\n// TODO return type\nfunction useTimelineSelection(event: React.FormEvent<HTMLFormElement>,\nsetGameFn: (Game) => void): \n  (event: React.FormEvent<HTMLFormElement>, setGameFn: (Game) => void) => void {\n\n  useEffect(() => {\n    async function load() {\n      useUrl(event, setGameFn).catch(e => console.log(e));\n    }\n    load();\n  }, [event, setGameFn]);\n\n  return (event, setGameFn) => {\n    async function load() {\n      useUrl(event, setGameFn).catch(e => console.log(e));\n    }\n    load();\n  }\n}\n\nexport default useTimelineSelection;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}