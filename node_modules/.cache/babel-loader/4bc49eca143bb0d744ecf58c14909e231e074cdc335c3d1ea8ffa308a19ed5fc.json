{"ast":null,"code":"import{useState,useContext,useEffect,useReducer,useCallback}from\"react\";import User from\"../classes/User\";import Fact from\"../classes/Fact\";import Timeline from\"../classes/Timeline\";import UserContext from\"../store/UserContext\";import UploadForm from\"./UploadForm\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const defaultTimeline=new Timeline({title:'',description:'',keyword:[],creator:'',facts:[]});function timelineReducer(state,action){let obj=action.payload;let newState=null;switch(action.type){case\"set\":newState=new Timeline({...state,...obj});break;case\"reset\":newState=defaultTimeline;break;case\"addFact\":newState=state.addFact(obj.fact);break;case\"removeFact\":newState=state.removeFact(obj.fact);break;case\"addFacts\":newState=state.addFacts(obj);break;default:newState=state;}return newState;}const defaultFact=new Fact({date:new Date(),info:\"Description\",img:\"https://picsum.photos/200.jpg\"});function factReducer(state,action){let obj=action.payload;let newState=null;switch(action.type){case\"set\":newState=new Fact({...state,...obj});break;case\"reset\":newState=defaultFact;break;default:newState=state;};return newState;}function updateReducer(dispatchFn){return function(field){let setValueFn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return function(event){let value=event.target.value;let newValue=setValueFn?setValueFn(value):value;dispatchFn({type:\"set\",payload:{[field]:newValue}});};};}export default function AdminPanel(){let userContext=useContext(UserContext);let authenticated=userContext.get.authenticated;let currentUser=userContext.get.currentUser;let userToken=userContext.get.userToken;let[timelineState,dispatchTimeline]=useReducer(timelineReducer,defaultTimeline);let[factState,dispatchFact]=useReducer(factReducer,defaultFact);const updateFact=updateReducer(dispatchFact);const updateTimeline=updateReducer(dispatchTimeline);let[initialTimeline,setInitialTimeline]=useState(null);let[saveReady,setSaveReady]=useState(false);let[updateTimelineList,setUpdateTimelineList]=useState(true);let[refresh,setRefresh]=useState(true);function activeStyle(isActive){return isActive?\"active\":\"inactive\";}// TODO doesn't show changes when fact lists are identical \n// (e.g., add an item, then delete it; still shows \"unsaved changes\")\nconst hasUnsavedChanges=useCallback(()=>{console.debug(initialTimeline);console.debug(timelineState);return timelineState&&initialTimeline&&!timelineState.equals(initialTimeline);},[timelineState,initialTimeline]);function Instructions(){return/*#__PURE__*/_jsx(\"p\",{className:\"instructions\",children:\"Your data will not be saved until you click Save.\"});}let[timelineList,setTimelineList]=useState([]);useEffect(()=>{async function loadTimelineList(user,token){let list=await user.loadUserTimelineList(token);if(list){setTimelineList(list);}}if(authenticated&&updateTimelineList){loadTimelineList(currentUser,userToken);setUpdateTimelineList(false);}else{setTimelineList([]);}},[authenticated,updateTimelineList,currentUser,userToken]);let[timelineID,setTimelineID]=useState(null);useEffect(()=>{async function loadTimeline(id,token){console.debug(\"Loading timeline id \".concat(timelineID));let response=await fetch(\"\".concat(User.SERVER,\"/timeline-full/\").concat(id),{method:\"GET\",headers:new Headers({\"Authorization\":\"Token \".concat(token)})});if(response.ok){let json=await response.json();console.debug(json);let creator=json.creator===\"\"?currentUser.username:json.creator;let newTimeline=new Timeline({id:json.id,title:json.title,description:json.description,keywords:Timeline.parseKeywords(json.keywords),creator:creator,facts:json.facts.map(f=>Fact.newFromYear(f))});dispatchTimeline({type:\"set\",payload:newTimeline});setInitialTimeline(newTimeline);}else{console.debug(\"Problem loading timeline with id \".concat(id,\": Server status \").concat(response.status,\", \").concat(response.statusText));}}if(timelineID){if(!hasUnsavedChanges()||window.confirm(\"Your quiz has unsaved changes. Do you want to discard the changes and load a new quiz?\")){if(timelineID===\"create\"){dispatchTimeline({type:\"reset\"});}else{loadTimeline(timelineID,userToken);}setUpdateTimelineList(true);setRefresh(false);}}},[timelineID,currentUser.username,userToken,refresh]);function Chooser(){function loadTimeline(event){event.preventDefault();let data=new FormData(event.target);let id=data.get(\"select-timeline\");// TODO if there are no unsaved changes\nsetTimelineID(id);}function timelineOption(timeline){return/*#__PURE__*/_jsx(\"option\",{value:timeline.id,children:timeline.title},timeline.id);}let[currentTimelineSelection,setCurrentTimelineSelection]=useState(\"create\");function updateSelection(event){setCurrentTimelineSelection(event.target.value);}let loadButtonText=currentTimelineSelection===\"create\"?\"Create\":\"Load\";return/*#__PURE__*/_jsxs(\"form\",{id:\"chooser\",onSubmit:loadTimeline,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"select-timeline\",children:\"Select a Timeline:\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"select-timeline\",defaultValue:\"create\",onChange:updateSelection,children:[/*#__PURE__*/_jsx(\"option\",{value:\"create\",children:\"Create New\"}),timelineList.map(timelineOption)]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:loadButtonText})]});}function MetadataPanel(){let creator=timelineState.creator===\"\"?currentUser.username:timelineState.creator;return/*#__PURE__*/_jsxs(\"section\",{id:\"metadata\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Metadata\"}),/*#__PURE__*/_jsx(\"form\",{className:\"timelinePanel\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"formInputBlock\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",onBlur:updateTimeline(\"title\"),defaultValue:timelineState.title})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description\",children:\"Description\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"description\",onBlur:updateTimeline(\"description\"),defaultValue:timelineState.description})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"keywords\",children:\"Keywords (separated with semicolons)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"keywords\",onBlur:updateTimeline(\"keywords\",Timeline.parseKeywords),defaultValue:timelineState.keywordString})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"creator\",children:\"Creator (for public display; default: your username)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"creator\",onBlur:updateTimeline(\"creator\"),defaultValue:creator})]})]})})]});}function CurrentFactsPanel(){function currentFact(item){function deleteFact(event){if(window.confirm(\"Are you sure you want to delete the current fact? Deleted facts can be recovered by reloading the timeline without first clicking Save.\")){console.debug(\"Delete item (date \".concat(item.date.getFullYear(),\")\"));dispatchTimeline({type:\"removeFact\",payload:{fact:item}});}}function editFact(event){console.debug(\"Edit item (date \".concat(item.date.getFullYear(),\")\"));dispatchFact({type:\"set\",payload:item});dispatchTimeline({type:\"removeFact\",payload:{fact:item}});}return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"FactListControls\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:editFact,children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:deleteFact,children:\"Delete\"})]})}),/*#__PURE__*/_jsx(\"td\",{children:item.year}),/*#__PURE__*/_jsx(\"td\",{children:item.info}),/*#__PURE__*/_jsx(\"td\",{children:item.img})]},crypto.randomUUID());}function Instructions(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"instructions\",children:\"Enter timeline events manually or upload the data using the forms below\"}),/*#__PURE__*/_jsx(UploadForm,{dispatch:dispatchTimeline})]});}return/*#__PURE__*/_jsxs(\"section\",{id:\"currentTimeline\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Current Timeline Events\"}),/*#__PURE__*/_jsx(Instructions,{}),/*#__PURE__*/_jsxs(\"table\",{className:\"timeline\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Controls\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Year\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Image URL\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:timelineState.facts.map(currentFact)})]})]});}function NewFactForm(){function newFact(event){if(factState.date&&factState.info){dispatchTimeline({type:\"addFact\",payload:{fact:factState}});console.debug(\"Added fact to timeline\");dispatchFact({type:\"reset\"});}}function CardPreview(_ref){let{fact}=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"card\",\"data-when\":factState.year,\"data-noselect\":\"noselect\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"date\",children:factState.year}),/*#__PURE__*/_jsx(\"img\",{alt:factState.img,src:factState.img}),/*#__PURE__*/_jsx(\"span\",{className:\"info\",children:factState.info})]});}function dateFromYear(year){let date=new Date();date.setFullYear(year);return date;}return/*#__PURE__*/_jsxs(\"section\",{id:\"new\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Add an Event\"}),/*#__PURE__*/_jsxs(\"form\",{id:\"addFactForm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"formInputBlock\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"date\",children:\"Year\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"date\",max:defaultFact.year,onChange:updateFact(\"date\",dateFromYear),defaultValue:factState.year})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"info\",children:\"Description of event\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"info\",onBlur:updateFact(\"info\"),defaultValue:factState.info})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"formItem\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"img\",children:\"Complete URL of image (optional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",name:\"img\",onBlur:updateFact(\"img\"),defaultValue:factState.img})]})]}),/*#__PURE__*/_jsxs(\"section\",{id:\"preview\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Preview\"}),/*#__PURE__*/_jsx(CardPreview,{fact:factState})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",id:\"add\",onClick:newFact,children:\"Add\"})]})]});}function SaveButton(){return/*#__PURE__*/_jsx(\"button\",{className:activeStyle(hasUnsavedChanges()),id:\"save\",type:\"button\",onClick:saveTimeline,children:\"Save\"});}// TODO indicate save state: \n// (1) metadata, (2) facts, (3) whole timeline on server\nfunction saveTimeline(event){let action=timelineState?\"Updated\":\"Created\";console.debug(\"\".concat(action,\" timeline with title '\").concat(timelineState.title,\"'\"));setSaveReady(true);}useEffect(()=>{async function postTimeline(user,token,timeline){console.debug(timeline.facts);console.debug(timeline.json());let response=await fetch(\"\".concat(User.SERVER,\"/timeline-full/\"),{method:\"POST\",headers:new Headers({\"Content-Type\":\"application/json\",\"Accept\":\"application/json\",\"Authorization\":\"Token \".concat(token)}),body:timeline.json()});if(response.ok){let json=await response.json();console.debug(json);}else{console.debug(\"Problem creating timeline: Server status \".concat(response.status,\", \").concat(response.statusText));}}if(saveReady){console.debug(\"Ready to post timeline\");console.debug(timelineState);postTimeline(currentUser,userToken,timelineState);setSaveReady(false);setUpdateTimelineList(true);}},[saveReady,timelineState,currentUser,userToken]);function DeleteTimelineButton(){let[timelineToDelete,setTimelineToDelete]=useState(null);function deleteTimeline(){if(window.confirm(\"Are you sure you want to delete this quiz? All of its fact cards will be lost. This action cannot be undone.\")){console.debug(timelineID);setTimelineToDelete(timelineID);}}useEffect(()=>{async function requestDeletion(timelineID,token){let result=false;let response=await fetch(\"\".concat(User.SERVER,\"/timelines/\").concat(timelineID,\"/\"),{method:\"DELETE\",headers:new Headers({\"Accept\":\"application/json\",\"Authorization\":\"Token \".concat(token)})});if(response.ok){let json=await response.json();console.debug(json);result=true;}else{console.debug(\"Could not delete timeline with id \".concat(timelineID,\": Server status \").concat(response.status,\", \").concat(response.statusText));result=false;}return result;}if(timelineToDelete!==null){console.debug(\"Deleting timeline with id \".concat(timelineToDelete));if(timelineID===\"create\"){dispatchTimeline({type:\"reset\"});}else{let deleted=requestDeletion(timelineToDelete,userToken);if(deleted){dispatchTimeline({type:\"reset\"});setUpdateTimelineList(true);}}setTimelineToDelete(null);}},[timelineToDelete]);let msg=timelineID===\"create\"?\"Reset Quiz\":\"Delete Quiz\";return/*#__PURE__*/_jsx(\"button\",{id:\"deleteTimeline\",type:\"button\",onClick:deleteTimeline,children:msg});}function DiscardChangesButton(){function discardChanges(event){setRefresh(true);}return/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:activeStyle(hasUnsavedChanges()),onClick:discardChanges,children:\"Discard Changes\"});}function Controls(){return/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[/*#__PURE__*/_jsx(SaveButton,{}),/*#__PURE__*/_jsx(DiscardChangesButton,{}),/*#__PURE__*/_jsx(DeleteTimelineButton,{})]});}return/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Manage Your Quizzes\"}),/*#__PURE__*/_jsx(Instructions,{}),/*#__PURE__*/_jsx(Chooser,{}),/*#__PURE__*/_jsx(MetadataPanel,{}),/*#__PURE__*/_jsx(CurrentFactsPanel,{}),/*#__PURE__*/_jsx(NewFactForm,{}),/*#__PURE__*/_jsx(Controls,{})]});}","map":{"version":3,"names":["useState","useContext","useEffect","useReducer","useCallback","User","Fact","Timeline","UserContext","UploadForm","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","defaultTimeline","title","description","keyword","creator","facts","timelineReducer","state","action","obj","payload","newState","type","addFact","fact","removeFact","addFacts","defaultFact","date","Date","info","img","factReducer","updateReducer","dispatchFn","field","setValueFn","arguments","length","undefined","event","value","target","newValue","AdminPanel","userContext","authenticated","get","currentUser","userToken","timelineState","dispatchTimeline","factState","dispatchFact","updateFact","updateTimeline","initialTimeline","setInitialTimeline","saveReady","setSaveReady","updateTimelineList","setUpdateTimelineList","refresh","setRefresh","activeStyle","isActive","hasUnsavedChanges","console","debug","equals","Instructions","className","children","timelineList","setTimelineList","loadTimelineList","user","token","list","loadUserTimelineList","timelineID","setTimelineID","loadTimeline","id","concat","response","fetch","SERVER","method","headers","Headers","ok","json","username","newTimeline","keywords","parseKeywords","map","f","newFromYear","status","statusText","window","confirm","Chooser","preventDefault","data","FormData","timelineOption","timeline","currentTimelineSelection","setCurrentTimelineSelection","updateSelection","loadButtonText","onSubmit","htmlFor","name","defaultValue","onChange","MetadataPanel","onBlur","keywordString","CurrentFactsPanel","currentFact","item","deleteFact","getFullYear","editFact","onClick","year","crypto","randomUUID","dispatch","NewFactForm","newFact","CardPreview","_ref","alt","src","dateFromYear","setFullYear","max","SaveButton","saveTimeline","postTimeline","body","DeleteTimelineButton","timelineToDelete","setTimelineToDelete","deleteTimeline","requestDeletion","result","deleted","msg","DiscardChangesButton","discardChanges","Controls"],"sources":["/home/andrewacashner/Documents/computing/javascript/react/chronoquiz/src/components/AdminPanel.tsx"],"sourcesContent":["import { useState, useContext, useEffect, useReducer, useCallback } from \"react\";\n\nimport User from \"../classes/User\";\nimport Fact from \"../classes/Fact\";\nimport Timeline from \"../classes/Timeline\";\n\nimport UserContext from \"../store/UserContext\";\n\nimport UploadForm from \"./UploadForm\";\n\nconst defaultTimeline = new Timeline({\n  title: '',\n  description: '',\n  keyword: [],\n  creator: '',\n  facts: []\n});\n\nfunction timelineReducer(state, action) {\n  let obj = action.payload;\n\n  let newState = null;\n  \n  switch(action.type) {\n    case \"set\":\n      newState = new Timeline({ ...state, ...obj });\n    break;\n\n    case \"reset\":\n      newState = defaultTimeline;\n    break;\n\n    case \"addFact\":\n      newState = state.addFact(obj.fact);\n    break;\n\n    case \"removeFact\":\n      newState = state.removeFact(obj.fact);\n    break;\n\n    case \"addFacts\":\n      newState = state.addFacts(obj);\n    break;\n\n    default:\n      newState = state; \n  }\n\n  return newState;\n}\n\n\nconst defaultFact = new Fact({\n  date: new Date(),\n  info: \"Description\", \n  img: \"https://picsum.photos/200.jpg\"\n});\n\nfunction factReducer(state, action) {\n  let obj = action.payload;\n  let newState = null;\n\n  switch(action.type) {\n    case \"set\":\n      newState = new Fact({ ...state, ...obj });\n    break;\n\n    case \"reset\":\n      newState = defaultFact;\n    break;\n\n    default:\n      newState = state;\n  };\n\n  return newState;\n}\n\nfunction updateReducer(dispatchFn: (obj: object) => obj) {\n  return function(\n    field: string, \n    setValueFn: (value: any) => any = null\n  ): void {\n    return function(event): void {\n      let value = event.target.value;\n      let newValue = setValueFn ? setValueFn(value) : value;\n      dispatchFn({\n        type: \"set\",\n        payload: { \n          [field]: newValue\n        }\n      });\n    };\n  }\n}\n\n\nexport default function AdminPanel() {\n  let userContext = useContext(UserContext);\n  let authenticated = userContext.get.authenticated;\n  let currentUser   = userContext.get.currentUser;\n  let userToken     = userContext.get.userToken;\n\n  let [timelineState, dispatchTimeline] = useReducer(timelineReducer, defaultTimeline);\n  let [factState, dispatchFact] = useReducer(factReducer, defaultFact);\n  \n  const updateFact = updateReducer(dispatchFact);\n  const updateTimeline = updateReducer(dispatchTimeline);\n\n  let [initialTimeline, setInitialTimeline] = useState(null);\n\n  let [saveReady, setSaveReady] = useState(false);\n  let [updateTimelineList, setUpdateTimelineList] = useState(true);\n  let [refresh, setRefresh] = useState(true);\n  \n  function activeStyle(isActive) {\n    return isActive ? \"active\" : \"inactive\";\n  }\n\n  // TODO doesn't show changes when fact lists are identical \n  // (e.g., add an item, then delete it; still shows \"unsaved changes\")\n  const hasUnsavedChanges = useCallback(() => {\n    console.debug(initialTimeline);\n    console.debug(timelineState);\n    return (timelineState && initialTimeline) \n      && !timelineState.equals(initialTimeline);\n  }, [timelineState, initialTimeline]);\n\n  function Instructions() {\n    return(\n      <p className=\"instructions\">Your data will not be saved until you click Save.</p>\n    );\n  }\n\n  let [timelineList, setTimelineList] = useState([]);\n\n  useEffect(() => {\n    async function loadTimelineList(user, token) {\n      let list = await user.loadUserTimelineList(token);\n      if (list) {\n        setTimelineList(list);\n      }\n    }\n    if (authenticated && updateTimelineList) {\n      loadTimelineList(currentUser, userToken);\n      setUpdateTimelineList(false);\n    } else {\n      setTimelineList([]);\n    }\n  }, [authenticated, updateTimelineList, currentUser, userToken]);\n\n  let [timelineID, setTimelineID] = useState(null);\n\n  useEffect(() => {\n    async function loadTimeline(id, token) {\n      console.debug(`Loading timeline id ${timelineID}`);\n      let response = await fetch(`${User.SERVER}/timeline-full/${id}`, {\n        method: \"GET\",\n        headers: new Headers({\n          \"Authorization\": `Token ${token}`\n        })\n      });\n\n      if (response.ok) {\n        let json = await response.json();\n        console.debug(json);\n        let creator = (json.creator === \"\")\n                      ? currentUser.username\n                      : json.creator;\n\n        let newTimeline = new Timeline({\n          id:           json.id,\n          title:        json.title,\n          description:  json.description,\n          keywords:     Timeline.parseKeywords(json.keywords),\n          creator:      creator,\n          facts:        json.facts.map(f => Fact.newFromYear(f))\n        });\n\n        dispatchTimeline({\n          type: \"set\",\n          payload: newTimeline\n        });\n\n        setInitialTimeline(newTimeline);\n\n      } else {\n        console.debug(`Problem loading timeline with id ${id}: Server status ${response.status}, ${response.statusText}`);\n      }\n    }\n\n    if (timelineID) {\n      if (!hasUnsavedChanges() || window.confirm(\"Your quiz has unsaved changes. Do you want to discard the changes and load a new quiz?\")) {\n        if (timelineID === \"create\") {\n          dispatchTimeline({ type: \"reset\" });\n        } else {\n          loadTimeline(timelineID, userToken);\n        }\n        setUpdateTimelineList(true);\n        setRefresh(false);\n      }\n    }\n  }, [timelineID, currentUser.username, userToken, refresh]);\n\n\n  function Chooser() {\n    function loadTimeline(event) {\n      event.preventDefault();\n      let data = new FormData(event.target);\n      let id = data.get(\"select-timeline\");\n      // TODO if there are no unsaved changes\n      setTimelineID(id);\n    }\n\n    function timelineOption(timeline) {\n      return(\n        <option key={timeline.id} value={timeline.id}>{timeline.title}</option>\n      );\n    }\n\n    let [currentTimelineSelection, setCurrentTimelineSelection] = useState(\"create\");\n\n    function updateSelection(event) {\n      setCurrentTimelineSelection(event.target.value);\n    }\n\n    let loadButtonText = (currentTimelineSelection === \"create\") \n                          ? \"Create\" : \"Load\";\n\n    return(\n      <form id=\"chooser\" onSubmit={loadTimeline}>\n        <label htmlFor=\"select-timeline\">Select a Timeline:</label>\n        <select name=\"select-timeline\" defaultValue=\"create\" onChange={updateSelection}>\n          <option value=\"create\">Create New</option>\n          { timelineList.map(timelineOption) }\n        </select>\n        <button type=\"submit\">{ loadButtonText }</button>\n      </form>\n    );\n  }\n\n  function MetadataPanel() {\n    let creator = (timelineState.creator === \"\") \n                  ? currentUser.username \n                  : timelineState.creator;\n\n    return(\n      <section id=\"metadata\">\n        <h2>Metadata</h2>\n        <form className=\"timelinePanel\">\n          <div className=\"formInputBlock\">\n            <div className=\"formItem\">\n              <label htmlFor=\"title\">Title</label>\n              <input type=\"text\" name=\"title\" \n                onBlur={updateTimeline(\"title\")}\n                defaultValue={timelineState.title} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"description\">Description</label>\n              <input type=\"text\" name=\"description\" \n                onBlur={updateTimeline(\"description\")}\n                defaultValue={timelineState.description} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"keywords\">Keywords (separated with semicolons)</label>\n              <input type=\"text\" name=\"keywords\" \n                onBlur={updateTimeline(\"keywords\", Timeline.parseKeywords)}\n                defaultValue={timelineState.keywordString} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"creator\">Creator (for public display; default: your username)</label>\n              <input type=\"text\" name=\"creator\" \n                onBlur={updateTimeline(\"creator\")}\n                defaultValue={creator}/>\n            </div>\n          </div>\n        </form>\n      </section>\n    );\n  }\n\n  function CurrentFactsPanel() {\n    function currentFact(item) {\n      function deleteFact(event) {\n        if (window.confirm(\"Are you sure you want to delete the current fact? Deleted facts can be recovered by reloading the timeline without first clicking Save.\")) {\n          console.debug(`Delete item (date ${item.date.getFullYear()})`);\n          dispatchTimeline({ \n            type: \"removeFact\",\n            payload: { fact: item }\n          });\n        }\n      }\n\n      function editFact(event) {\n        console.debug(`Edit item (date ${item.date.getFullYear()})`);\n        dispatchFact({\n          type: \"set\",\n          payload: item\n        });\n        dispatchTimeline({ \n          type: \"removeFact\",\n          payload: { fact: item }\n        });\n      }\n\n      return(\n        <tr key={crypto.randomUUID()}>\n          <td>\n            <div className=\"FactListControls\">\n              <button type=\"button\" onClick={editFact}>Edit</button>\n              <button type=\"button\" onClick={deleteFact}>Delete</button>\n            </div>\n          </td>\n          <td>{item.year}</td>\n          <td>{item.info}</td>\n          <td>{item.img}</td>\n        </tr>\n      );\n    }\n\n    function Instructions() {\n      return(\n        <>\n          <p className=\"instructions\">Enter timeline events manually or upload the data using the forms below</p>\n          <UploadForm dispatch={dispatchTimeline} />\n        </>\n      );\n    }\n\n    return(\n      <section id=\"currentTimeline\">\n        <h2>Current Timeline Events</h2>\n        <Instructions />\n        <table className=\"timeline\">\n          <thead>\n            <tr>\n              <th>Controls</th>\n              <th>Year</th>\n              <th>Description</th>\n              <th>Image URL</th>\n            </tr>\n          </thead>\n          <tbody>\n            { timelineState.facts.map(currentFact) }\n          </tbody>\n        </table>\n      </section>\n    );\n  }\n\n  function NewFactForm() {\n\n    function newFact(event) {\n      if (factState.date && factState.info) {\n        dispatchTimeline({\n          type: \"addFact\",\n          payload: { fact: factState }\n        });\n        console.debug(\"Added fact to timeline\");\n        dispatchFact({ type: \"reset\" });\n      }\n    }\n    \n    function CardPreview({ fact }) {\n      return(\n        <div className=\"card\" data-when={factState.year} data-noselect=\"noselect\">\n          <span className=\"date\">{factState.year}</span>\n          <img alt={factState.img} src={factState.img} />\n          <span className=\"info\">{factState.info}</span>\n        </div>\n      );\n    }\n\n\n    function dateFromYear(year: number): Date {\n      let date = new Date();\n      date.setFullYear(year);\n      return date\n    }\n\n    return(\n      <section id=\"new\">\n        <h2>Add an Event</h2>\n        <form id=\"addFactForm\">\n          <div className=\"formInputBlock\">\n            <div className=\"formItem\">\n              <label htmlFor=\"date\">Year</label>\n              <input \n                type=\"number\" \n                name=\"date\" \n                max={defaultFact.year}\n                onChange={updateFact(\"date\", dateFromYear)}\n                defaultValue={factState.year} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"info\">Description of event</label>\n              <input \n                type=\"text\" \n                name=\"info\" \n                onBlur={updateFact(\"info\")}\n                defaultValue={factState.info} />\n            </div>\n            <div className=\"formItem\">\n              <label htmlFor=\"img\">Complete URL of image (optional)</label>\n              <input \n                type=\"url\" \n                name=\"img\" \n                onBlur={updateFact(\"img\")}\n                defaultValue={factState.img} />\n            </div>\n          </div>\n          <section id=\"preview\">\n            <h3>Preview</h3>\n            <CardPreview fact={factState} />\n          </section>\n          <button type=\"button\" id=\"add\" onClick={newFact}>Add</button>\n        </form>\n      </section>\n    );\n  }\n\n  \n  function SaveButton() {\n    return(\n      <button className={activeStyle(hasUnsavedChanges())} id=\"save\" type=\"button\" onClick={saveTimeline}>Save</button>\n    );\n  }\n\n\n  // TODO indicate save state: \n  // (1) metadata, (2) facts, (3) whole timeline on server\n  function saveTimeline(event) {\n    let action = timelineState ? \"Updated\" : \"Created\";\n    console.debug(`${action} timeline with title '${timelineState.title}'`);\n    setSaveReady(true);\n  }\n\n  useEffect(() => {\n    async function postTimeline(user, token, timeline) {\n      console.debug(timeline.facts);\n      console.debug(timeline.json());\n      let response = await fetch(`${User.SERVER}/timeline-full/`, {\n        method: \"POST\",\n        headers: new Headers({\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\",\n          \"Authorization\": `Token ${token}`\n        }),\n        body: timeline.json()\n      });\n      if (response.ok) {\n        let json = await response.json();\n        console.debug(json);\n      } else {\n        console.debug(`Problem creating timeline: Server status ${response.status}, ${response.statusText}`);\n      }\n    }\n    if (saveReady) {\n      console.debug(\"Ready to post timeline\");\n      console.debug(timelineState);\n      postTimeline(currentUser, userToken, timelineState);\n      setSaveReady(false);\n      setUpdateTimelineList(true);\n    } \n  }, [saveReady, timelineState, currentUser, userToken]);\n  \n\n  function DeleteTimelineButton() {\n    let [timelineToDelete, setTimelineToDelete] = useState(null);\n\n    function deleteTimeline() {\n      if (window.confirm(\"Are you sure you want to delete this quiz? All of its fact cards will be lost. This action cannot be undone.\")) {\n        console.debug(timelineID);\n        setTimelineToDelete(timelineID);\n      }\n    }\n\n    useEffect(() => {\n      async function requestDeletion(timelineID, token) {\n        let result = false;\n        let response = await fetch(`${User.SERVER}/timelines/${timelineID}/`, {\n          method: \"DELETE\",\n          headers: new Headers({\n            \"Accept\": \"application/json\",\n            \"Authorization\": `Token ${token}`\n          })\n        });\n        if (response.ok) {\n          let json = await response.json();\n          console.debug(json);\n          result = true;\n        } else {\n          console.debug(`Could not delete timeline with id ${timelineID}: Server status ${response.status}, ${response.statusText}`);\n          result = false;\n        }\n        return result;\n      }\n\n      if (timelineToDelete !== null) {\n        console.debug(`Deleting timeline with id ${timelineToDelete}`);\n\n        if (timelineID === \"create\") {\n          dispatchTimeline({ type: \"reset\" });\n        } else {\n          let deleted = requestDeletion(timelineToDelete, userToken);\n          if (deleted) {\n            dispatchTimeline({ type: \"reset\" });\n            setUpdateTimelineList(true);\n          }\n        }\n\n        setTimelineToDelete(null);\n      }\n    }, [timelineToDelete]);\n\n    let msg = (timelineID === \"create\") ? \"Reset Quiz\" : \"Delete Quiz\";\n    return(\n      <button id=\"deleteTimeline\" type=\"button\" onClick={deleteTimeline}>{ msg }</button>\n    );\n  }\n\n\n  function DiscardChangesButton() {\n    function discardChanges(event) {\n      setRefresh(true);\n    }\n\n    return(\n      <button type=\"button\" className={activeStyle(hasUnsavedChanges())} onClick={discardChanges}>Discard Changes</button>\n    );\n  }\n\n  function Controls() {\n    return(\n      <div className=\"controls\">\n        <SaveButton />\n        <DiscardChangesButton />\n        <DeleteTimelineButton />\n      </div>\n    );\n  }\n  return(\n    <main>\n      <h1>Manage Your Quizzes</h1>\n      <Instructions />\n      <Chooser />\n      <MetadataPanel />\n      <CurrentFactsPanel />\n      <NewFactForm />\n      <Controls />\n    </main>\n  );\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}