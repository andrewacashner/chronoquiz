{"ast":null,"code":"import{useContext,useState,useEffect}from\"react\";import Card from\"../classes/Card\";import FactList from\"../classes/FactList\";import Game from\"../classes/Game\";import RestartButton from\"./RestartButton\";import TimelineContext from\"../store/TimelineContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function isInputValid(json){return typeof json===\"object\"&&Array.isArray(json)&&json.length>0&&json.every(fact=>\"date\"in fact&&\"info\"in fact);}async function clueListFromJson(json){let cards=[];try{if(json&&json.length>0){for(let entry of json){try{let card=await Card.newSafeCard(entry);if(card&&card.isSafe){cards.push(card);}else{throw new Error(\"Faulty card input {date: '\".concat(entry.date,\"', info: '\").concat(entry.info.slice(0,15),\"...'}; skipping\"));}}catch(e){console.error(e);}}}}catch(e){console.error(e);}return new FactList(cards);}export default function InputForm(_ref){let{src}=_ref;let context=useContext(TimelineContext);let setGame=context.set;let[url,setUrl]=useState(\"\");let[json,setJson]=useState(null);let[uploadVisible,setUploadVisible]=useState(false);let[isGameActive,setIsGameActive]=useState(false);function getUrl(event){event.preventDefault();setIsGameActive(true);setUrl(src);console.debug(\"Set URL to \".concat(src));//    let source = event.target.source.value;\n//    let files = event.target.fileInput.files;\n//    let newUrl = (files.length > 0) \n//                  ? URL.createObjectURL(files[0]) \n//                  : `./input/${source}.json`;\n//    setUrl(newUrl);\n}useEffect(()=>{async function fetchUrl(){if(url){console.log(\"Loading file \".concat(url));try{let response=await fetch(url);let newJson;let contentType=response.headers.get(\"content-type\");if(contentType&&contentType.includes(\"application/json\")){newJson=await response.json();}else{throw new Error(\"No JSON input: \".concat(response));}if(isInputValid(newJson)){setJson(newJson);}else{alert(\"Could not create a timeline from JSON file at \".concat(url));window.location.reload();throw new Error(\"Unusable JSON input; restarting\");}}catch(e){console.error(e);}}}fetchUrl();},[url]);useEffect(()=>{async function loadClues(json){try{let newClues=await clueListFromJson(json);newClues.setupClues();setGame(prevGame=>new Game({clues:newClues,timeline:prevGame.timeline,score:prevGame.score,isActive:isGameActive}));}catch(e){console.error(e);}}loadClues(json);},[json,setGame,isGameActive]);function showUploadButton(event){let value=event.target.value;setUploadVisible(value===\"upload\");}function visibility(isVisible){return isVisible?\"show\":\"hide\";}function SelectTimeline(){return/*#__PURE__*/_jsxs(\"div\",{className:visibility(!isGameActive),children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"source\",children:\"Choose a timeline:\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"source\",id:\"source\",onChange:showUploadButton,required:true,defaultValue:\"music\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"music\",children:\"Music\"}),/*#__PURE__*/_jsx(\"option\",{value:\"wars\",children:\"Wars\"}),/*#__PURE__*/_jsx(\"option\",{value:\"upload\",children:\"Upload a custom timeline...\"})]})]});}function FileInput(){return/*#__PURE__*/_jsxs(\"div\",{id:\"file\",className:visibility(!isGameActive&&uploadVisible),children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"fileInput\",children:[\"Upload JSON timeline file (\",/*#__PURE__*/_jsx(\"a\",{href:\"about.html\",children:\"?\"}),\")\"]}),/*#__PURE__*/_jsx(\"input\",{id:\"fileInput\",type:\"file\",accept:\".json\"})]});}// TODO \"Play again\" doesn't work\nfunction PlayButton(){function playMsg(isGameActive){return isGameActive?\"Play again!\":\"Play!\";}return/*#__PURE__*/_jsx(\"button\",{type:\"submit\",id:\"playbutton\",children:playMsg(isGameActive)});}// <SelectTimeline />\n// <FileInput />\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"form\",{id:\"inputForm\",onSubmit:getUrl,children:/*#__PURE__*/_jsx(PlayButton,{})}),isGameActive?/*#__PURE__*/_jsx(RestartButton,{}):null]});}","map":{"version":3,"names":["useContext","useState","useEffect","Card","FactList","Game","RestartButton","TimelineContext","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","isInputValid","json","Array","isArray","length","every","fact","clueListFromJson","cards","entry","card","newSafeCard","isSafe","push","Error","concat","date","info","slice","e","console","error","InputForm","_ref","src","context","setGame","set","url","setUrl","setJson","uploadVisible","setUploadVisible","isGameActive","setIsGameActive","getUrl","event","preventDefault","debug","fetchUrl","log","response","fetch","newJson","contentType","headers","get","includes","alert","window","location","reload","loadClues","newClues","setupClues","prevGame","clues","timeline","score","isActive","showUploadButton","value","target","visibility","isVisible","SelectTimeline","className","children","htmlFor","name","id","onChange","required","defaultValue","FileInput","href","type","accept","PlayButton","playMsg","onSubmit"],"sources":["/home/andrewacashner/Documents/computing/javascript/react/chronoquiz/src/components/InputForm.tsx"],"sourcesContent":["import { useContext, useState, useEffect } from \"react\";\n\nimport Card from \"../classes/Card\";\nimport FactList from \"../classes/FactList\";\nimport Game from \"../classes/Game\";\n\nimport RestartButton from \"./RestartButton\";\n\nimport TimelineContext from \"../store/TimelineContext\";\n\nfunction isInputValid(json: any): boolean {\n  return typeof json === \"object\"\n  && Array.isArray(json) \n  && json.length > 0 \n  && json.every(fact => (\"date\" in fact) && (\"info\" in fact));\n}\n\nasync function clueListFromJson(json: object): FactList { \n  let cards = [];\n  try {\n    if (json && json.length > 0) {\n      for (let entry of json) {\n        try {\n          let card = await Card.newSafeCard(entry);\n          if (card && card.isSafe) {\n            cards.push(card);\n          } else {\n            throw new Error(`Faulty card input {date: '${entry.date}', info: '${entry.info.slice(0, 15)}...'}; skipping`);\n          }\n        } catch(e) {\n          console.error(e);\n        }\n      }\n    }\n  } catch(e) {\n    console.error(e);\n  }\n  return new FactList(cards);\n}\n\n\nexport default function InputForm({ src }) {\n\n  let context = useContext(TimelineContext);\n  let setGame = context.set;\n\n  let [url, setUrl] = useState(\"\");\n  let [json, setJson] = useState(null);\n  let [uploadVisible, setUploadVisible] = useState(false);\n  let [isGameActive, setIsGameActive] = useState(false);\n\n  function getUrl(event: React.FormEvent<HTMLFormElement>): void {\n    event.preventDefault();\n    setIsGameActive(true); \n    setUrl(src);\n    console.debug(`Set URL to ${src}`);\n\n    //    let source = event.target.source.value;\n    //    let files = event.target.fileInput.files;\n    //    let newUrl = (files.length > 0) \n    //                  ? URL.createObjectURL(files[0]) \n    //                  : `./input/${source}.json`;\n    //    setUrl(newUrl);\n  }\n  \n  useEffect(() => {\n    async function fetchUrl(): void {\n      if (url) {\n        console.log(`Loading file ${url}`);\n\n        try {\n          let response = await fetch(url);\n\n          let newJson;\n          let contentType = response.headers.get(\"content-type\");\n          \n          if (contentType && contentType.includes(\"application/json\")) {\n            newJson = await response.json();\n          } else {\n            throw new Error(`No JSON input: ${response}`);\n          }\n\n          if (isInputValid(newJson)) {\n            setJson(newJson);\n          } else {\n            alert(`Could not create a timeline from JSON file at ${url}`);\n            window.location.reload();\n            throw new Error(\"Unusable JSON input; restarting\");\n          }\n        } catch(e) { \n          console.error(e); \n        }\n      }\n    }\n    fetchUrl();\n  }, [url]);\n\n  useEffect(() => {\n    async function loadClues(json) {\n      try {\n        let newClues = await clueListFromJson(json);\n        newClues.setupClues();\n        setGame(prevGame => new Game({ \n          clues: newClues,\n          timeline: prevGame.timeline,\n          score: prevGame.score,\n          isActive: isGameActive\n        }));\n      } catch(e) {\n        console.error(e);\n      }\n    }\n\n    loadClues(json);\n  }, [json, setGame, isGameActive])\n\n\n  function showUploadButton(event: React.FormEvent<HTMLFormElement>): void {\n    let value = event.target.value;\n    setUploadVisible(value === \"upload\");\n  }\n\n  function visibility(isVisible: boolean): string {\n    return (isVisible) ? \"show\" : \"hide\";\n  }\n\n\n  function SelectTimeline() {\n    return(\n      <div className={visibility(!isGameActive)}>\n        <label htmlFor=\"source\">Choose a timeline:</label>\n        <select name=\"source\" id=\"source\" \n          onChange={showUploadButton}\n          required defaultValue=\"music\">\n          <option value=\"music\">Music</option>\n          <option value=\"wars\">Wars</option>\n          <option value=\"upload\">Upload a custom timeline...</option>\n        </select>\n      </div>\n    );\n  }\n\n  function FileInput() {\n    return(\n      <div id=\"file\" className={visibility(!isGameActive && uploadVisible)}>\n        <label htmlFor=\"fileInput\">Upload JSON timeline file (<a href=\"about.html\">?</a>)</label>\n        <input id=\"fileInput\" type=\"file\" accept=\".json\" />\n      </div>\n    );\n  }\n\n  // TODO \"Play again\" doesn't work\n  function PlayButton() {\n\n    function playMsg(isGameActive: boolean): string {\n      return (isGameActive) ? \"Play again!\" : \"Play!\";\n    }\n\n    return(\n      <button type=\"submit\" id=\"playbutton\">{playMsg(isGameActive)}</button>\n    );\n  }\n\n  // <SelectTimeline />\n  // <FileInput />\n  return(\n    <>\n      <form id=\"inputForm\" onSubmit={getUrl}>\n        <PlayButton />\n      </form>\n      {isGameActive ? <RestartButton /> : null }\n    </>\n  );\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}